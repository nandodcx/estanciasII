<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Universitario - Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#9BD86B",
                        "secondary": "#10b981",
                        "background-light": "#f6f7f8",
                        "new-practice": "#9BD86B"
                    },
                    fontFamily: {
                        "display": ["Public Sans"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Public Sans', sans-serif;
        }
        
        /* Estilos para los toggles */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #9BD86B;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        /* HEADER MEJORADO - CON IMAGEN */
        .header-container {
            background-color: white;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            transition: filter 0.3s ease;
        }

        .header-container.modal-open {
            filter: brightness(0.8);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            max-width: 100%;
            margin: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo-img {
            height: 50px;
            width: auto;
            object-fit: contain;
        }

        .university-name {
            font-size: 18px;
            font-weight: 700;
            color: #003300;
            line-height: 1.2;
        }

        .university-line1 {
            font-size: 20px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-image-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-initials {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #9BD86B);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .user-initials:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .user-name {
            font-weight: 500;
            color: #333;
        }

        /* MENÚ HAMBURGUESA */
        .hamburger-menu {
            display: none;
            flex-direction: column;
            justify-content: space-between;
            width: 30px;
            height: 21px;
            cursor: pointer;
        }

        .hamburger-menu span {
            display: block;
            height: 3px;
            width: 100%;
            background-color: #333;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1001;
            padding: 15px;
            width: 250px;
            border-radius: 0 0 0 8px;
        }

        .mobile-menu.active {
            display: block;
        }

        /* Información del usuario en menú móvil */
        .mobile-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
        }

        .mobile-user-image {
            display: flex;
            align-items: center;
        }

        .mobile-user-details {
            display: flex;
            flex-direction: column;
        }

        .mobile-user-name {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .mobile-user-role {
            color: #666;
            font-size: 14px;
        }

        .mobile-menu-item {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            font-weight: 500;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mobile-menu-item:last-child {
            border-bottom: none;
        }

        .mobile-menu-item i {
            color: #9BD86B;
            width: 20px;
        }

        .mobile-menu-item:hover {
            background-color: #f5f5f5;
            padding-left: 10px;
            border-radius: 4px;
        }

        .mobile-menu-item.cerrar-sesion {
            color: #e74c3c;
        }

        .mobile-menu-item.cerrar-sesion i {
            color: #e74c3c;
        }

        /* RESPONSIVE DESIGN - CORREGIDO */
        @media (max-width: 768px) {
            .header {
                padding: 10px 15px;
            }
            
            .logo-img {
                height: 40px;
            }
            
            .university-name {
                font-size: 14px;
            }
            
            .university-line1 {
                font-size: 14px;
            }
            
            .user-image-container {
                display: none !important;
            }
            
            .user-name {
                display: none !important;
            }
            
            .hamburger-menu {
                display: flex !important;
            }
            
            .user-profile {
                gap: 0;
                justify-content: flex-end;
            }
        }

        /* Media query adicional para pantallas muy pequeñas */
        @media (max-width: 480px) {
            .header-left {
                gap: 10px;
            }
            
            .university-name {
                font-size: 12px;
            }
            
            .university-line1 {
                font-size: 12px;
            }
            
            .hamburger-menu {
                width: 25px;
                height: 18px;
            }
            
            .mobile-menu {
                width: 220px;
            }
            
            .mobile-user-info {
                gap: 10px;
                padding: 12px 0;
            }
            
            .mobile-user-name {
                font-size: 14px;
            }
            
            .mobile-user-role {
                font-size: 12px;
            }
        }

        /* Estilos originales del dashboard */
        .sortable:hover {
            cursor: pointer;
            background-color: rgba(0, 0, 0, 0.05);
        }
        .sort-icon {
            margin-left: 5px;
            opacity: 0.5;
        }
        .active-sort {
            background-color: rgba(155, 216, 107, 0.1);
        }
        .sidebar {
            transition: all 0.3s ease;
        }
        .dashboard-card {
            transition: all 0.3s ease;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .mobile-menu-open {
            transform: translateX(0);
        }
        .mobile-menu-closed {
            transform: translateX(-100%);
        }
        @media (min-width: 768px) {
            .mobile-menu-closed {
                transform: translateX(0);
            }
        }

        /* Estilos para la tabla de horarios - CORREGIDOS */
        .schedule-container {
            margin-bottom: 30px;
        }
        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .schedule-legend {
            display: flex;
            gap: 15px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        .legend-color {
            width: 15px;
            height: 15px;
            border-radius: 3px;
        }
        .schedule-wrapper {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
        }
        
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
        }
        
        .schedule-table th, .schedule-table td {
            border: 1px solid #e5e7eb;
            padding: 8px;
            text-align: center;
        }
        
        .schedule-table th {
            background-color: #f3f4f6;
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
        }
        
        .time-slot {
            height: 40px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }
        .time-slot.available {
            background-color: #d1fae5;
            color: #065f46;
        }
        .time-slot.occupied {
            background-color: #fecaca;
            color: #dc2626;
        }
        .time-slot.selected {
            background-color: #9BD86B;
            color: white;
        }
        .time-slot:hover {
            transform: scale(1.05);
        }
        .selected-slots-container {
            background-color: #f0f9ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }
        .selected-slot {
            display: inline-block;
            background-color: #9BD86B;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px;
            font-size: 14px;
        }
        
        /* Estilos para el botón de cerrar sesión en el sidebar - ADAPTADOS DEL CÓDIGO MÁS PEQUEÑO */
        .logout-sidebar {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            padding: 0 16px;
        }
        
        .logout-sidebar .logout-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: #e74c3c !important;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            text-decoration: none;
        }
        
        .logout-sidebar .logout-link:hover {
            background-color: #fee2e2;
        }
        
        .logout-sidebar .logout-link i {
            color: #e74c3c !important;
        }
        
        /* Asegurar que el sidebar tenga posición relativa para el posicionamiento absoluto del logout */
        .sidebar-container {
            position: relative;
            height: 100%;
        }

        /* === NUEVOS ESTILOS MEJORADOS PARA ACTIVIDAD RECIENTE Y PRÓXIMAS PRÁCTICAS === */

        /* Grid responsivo */
        .grid.grid-cols-1.lg\:grid-cols-2.gap-6 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .grid.grid-cols-1.lg\:grid-cols-2.gap-6 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Estilo base de las tarjetas */
        .bg-white {
            background-color: white;
        }

        .rounded-xl {
            border-radius: 0.75rem;
        }

        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .p-6 {
            padding: 1.5rem;
        }

        .border.border-gray-200 {
            border: 1px solid #e5e7eb;
        }

        .flex.flex-col {
            display: flex;
            flex-direction: column;
        }

        /* Encabezados de Sección */
        .text-lg {
            font-size: 1.125rem;
            line-height: 1.75rem;
        }

        .font-semibold {
            font-weight: 600;
        }

        .text-gray-800 {
            color: #1f2937;
        }

        .mb-4 {
            margin-bottom: 1rem;
        }

        .flex.justify-between.items-center {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Contenedores de Contenido */
        .space-y-4 > * + * {
            margin-top: 1rem;
        }

        .space-y-3 > * + * {
            margin-top: 0.75rem;
        }

        .flex-1 {
            flex: 1 1 0%;
        }

        /* Estilos específicos para actividades recientes */
        .activity-item {
            display: flex;
            align-items: start;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .activity-item:hover {
            background-color: #f9fafb;
            transform: translateX(5px);
        }

        .activity-icon {
            flex-shrink: 0;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-size: 0.875rem;
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.25rem;
        }

        .activity-detail {
            font-size: 0.75rem;
            color: #6b7280;
            line-height: 1.4;
        }

        .activity-time {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }

        /* === ESTILOS ADAPTADOS PARA PRÓXIMAS PRÁCTICAS === */
        /* Diseño adaptado del código proporcionado */
        .upcoming-practice-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upcoming-practice-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .upcoming-practice-info {
            flex: 1;
        }

        .upcoming-practice-name {
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .upcoming-practice-meta {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .upcoming-practice-status {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
            white-space: nowrap;
        }

        /* Estados de las prácticas - Adaptados del diseño proporcionado */
        .status-programada {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .status-confirmada {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-pendiente {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-en-curso {
            background-color: #fef3c7;
            color: #92400e;
        }

        .status-completada {
            background-color: #dcfce7;
            color: #166534;
        }

        .status-cancelada {
            background-color: #fecaca;
            color: #dc2626;
        }

        /* Estados vacío */
        .empty-state {
            text-align: center;
            padding: 2rem 1rem;
            color: #6b7280;
        }

        .empty-state i {
            font-size: 2rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
    </style>
</head>
<body class="bg-background-light font-display">
    <!-- HEADER CORREGIDO - AHORA ES FIXED -->
    <div class="header-container" id="header-container">
        <div class="header">
            <div class="header-left">
                <div class="logo-container">
                    <img src="../assets/img/logo2.jpg" alt="UNIPOLI Logo" class="logo-img">
                </div>
                <div class="university-name">
                    <div class="university-line1" data-i18n="university.line1">Universidad Politécnica de</div>
                    <div class="university-line1" data-i18n="university.line2">Durango</div>
                </div>
            </div>
            
            <div class="user-profile">
                <div class="user-image-container">
                    <div class="user-initials" id="user-initials-btn">
                        A
                    </div>
                </div>
                <div class="user-name" data-i18n="header.admin">Administrador</div>
                <div class="hamburger-menu" id="hamburger-menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
        
        <!-- MENÚ MÓVIL MEJORADO - AHORA CON NAVEGACIÓN COMPLETA -->
        <div class="mobile-menu" id="mobile-menu">
            <!-- Información del usuario en el menú móvil -->
            <div class="mobile-user-info">
                <div class="mobile-user-image">
                    <div class="user-initials">
                        A
                    </div>
                </div>
                <div class="mobile-user-details">
                    <div class="mobile-user-name" data-i18n="header.admin">Administrador</div>
                    <div class="mobile-user-role" data-i18n="header.admin">Administrador</div>
                </div>
            </div>
            
            <!-- Navegación completa en menú móvil -->
            <div class="mobile-menu-item" onclick="showView('dashboard-view'); closeMobileMenu();">
                <i class="fas fa-tachometer-alt"></i>
                <span data-i18n="menu.dashboard">Dashboard</span>
            </div>
            <div class="mobile-menu-item" onclick="showView('practices-view'); closeMobileMenu();">
                <i class="fas fa-laptop-code"></i>
                <span data-i18n="menu.practices">Prácticas</span>
            </div>
            <div class="mobile-menu-item" onclick="showView('agenda-view'); closeMobileMenu();">
                <i class="fas fa-calendar-alt"></i>
                <span data-i18n="menu.agenda">Agenda</span>
            </div>
            <div class="mobile-menu-item" onclick="showView('users-view'); closeMobileMenu();">
                <i class="fas fa-users"></i>
                <span data-i18n="menu.users">Usuarios</span>
            </div>
            <div class="mobile-menu-item" onclick="showView('laboratories-view'); closeMobileMenu();">
                <i class="fas fa-flask"></i>
                <span data-i18n="menu.laboratories">Laboratorios</span>
            </div>
            <div class="mobile-menu-item" onclick="showView('reports-view'); closeMobileMenu();">
                <i class="fas fa-chart-bar"></i>
                <span data-i18n="menu.reports">Reportes</span>
            </div>
            <div class="mobile-menu-item" onclick="showView('settings-view'); closeMobileMenu();">
                <i class="fas fa-cog"></i>
                <span data-i18n="menu.settings">Configuración</span>
            </div>
            
            <!-- Opciones de usuario - PERFIL ELIMINADO -->
            <div class="mobile-menu-item cerrar-sesion" onclick="abrirModalCerrarSesion()">
                <i class="fas fa-sign-out-alt"></i>
                <span data-i18n="menu.logout">Cerrar Sesión</span>
            </div>
        </div>
    </div>

    <div class="flex pt-16">
        <!-- Mobile Sidebar - CORREGIDO Z-INDEX -->
        <div id="mobile-sidebar" class="mobile-menu-closed md:hidden fixed inset-0 z-30 bg-black bg-opacity-50 transition-opacity">
            <div class="sidebar w-64 bg-white h-full shadow-md border-r border-gray-200 transform transition-transform sidebar-container">
                <div class="p-4 h-full flex flex-col">
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-lg font-bold text-gray-800" data-i18n="menu.title">Menú</span>
                            <button id="close-mobile-menu" class="p-2 text-gray-700 rounded-lg hover:bg-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <ul class="space-y-2">
                            <li>
                                <a href="#" id="mobile-dashboard-link" class="flex items-center gap-3 p-3 rounded-lg bg-primary text-white">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span data-i18n="menu.dashboard">Dashboard</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" id="mobile-practices-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-laptop-code"></i>
                                    <span data-i18n="menu.practices">Prácticas</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" id="mobile-agenda-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span data-i18n="menu.agenda">Agenda</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" id="mobile-users-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-users"></i>
                                    <span data-i18n="menu.users">Usuarios</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" id="mobile-laboratories-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-flask"></i>
                                    <span data-i18n="menu.laboratories">Laboratorios</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" id="mobile-reports-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-chart-bar"></i>
                                    <span data-i18n="menu.reports">Reportes</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" id="mobile-settings-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-cog"></i>
                                    <span data-i18n="menu.settings">Configuración</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Botón Cerrar Sesión en color rojo - POSICIONADO EN LA PARTE INFERIOR - ADAPTADO DEL CÓDIGO MÁS PEQUEÑO -->
                    <div class="logout-sidebar">
                        <a href="#" id="mobile-logout-link" class="logout-link" onclick="abrirModalCerrarSesion()">
                            <i class="fas fa-sign-out-alt"></i>
                            <span data-i18n="menu.logout">Cerrar Sesión</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Desktop Sidebar FIJADO - CORREGIDO Z-INDEX -->
        <div class="sidebar hidden md:block w-64 bg-white fixed top-16 left-0 h-[calc(100vh-4rem)] shadow-md border-r border-gray-200 overflow-y-auto z-30 sidebar-container">
            <div class="p-4 h-full flex flex-col">
                <div class="flex-1">
                    <ul class="space-y-2">
                        <li>
                            <a href="#" id="dashboard-link" class="flex items-center gap-3 p-3 rounded-lg bg-primary text-white">
                                <i class="fas fa-tachometer-alt"></i>
                                <span data-i18n="menu.dashboard">Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="practices-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-laptop-code"></i>
                                <span data-i18n="menu.practices">Prácticas</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="agenda-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-calendar-alt"></i>
                                <span data-i18n="menu.agenda">Agenda</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="users-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-users"></i>
                                <span data-i18n="menu.users">Usuarios</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="laboratories-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-flask"></i>
                                <span data-i18n="menu.laboratories">Laboratorios</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="reports-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-chart-bar"></i>
                                <span data-i18n="menu.reports">Reportes</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" id="settings-link" class="flex items-center gap-3 p-3 rounded-lg text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-cog"></i>
                                <span data-i18n="menu.settings">Configuración</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <!-- Botón Cerrar Sesión en color rojo - POSICIONADO EN LA PARTE INFERIOR - ADAPTADO DEL CÓDIGO MÁS PEQUEÑO -->
                <div class="logout-sidebar">
                    <a href="#" id="logout-link" class="logout-link" onclick="abrirModalCerrarSesion()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span data-i18n="menu.logout">Cerrar Sesión</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content - CORREGIDO -->
        <div class="flex-1 p-6 md:ml-64 mt-0">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="fade-in">
                <h1 class="text-2xl font-bold text-gray-800 mb-6" data-i18n="dashboard.title">Dashboard de Administración</h1>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="dashboard-card bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600" data-i18n="dashboard.totalPractices">Total Prácticas</p>
                                <p class="text-2xl font-bold text-gray-800" id="total-practices">0</p>
                            </div>
                            <div class="p-3 rounded-lg" style="background-color: #AED5F5;">
                                <i class="fas fa-laptop-code text-blue-600 text-2xl"></i>
                            </div>

                        </div>
                        <div class="mt-4">
                            <div class="flex items-center text-sm text-green-500">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span data-i18n="dashboard.stats.increase">12% más que el mes pasado</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600" data-i18n="dashboard.monthPractices">Prácticas Este Mes</p>
                                <p class="text-2xl font-bold text-gray-800" id="month-practices">0</p>
                            </div>
                            <div class="p-3 bg-green-100 rounded-lg">
                                <i class="fas fa-calendar-check text-green-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex items-center text-sm text-green-500">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span data-i18n="dashboard.stats.weeklyIncrease">5% más que la semana pasada</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600" data-i18n="dashboard.professors">Profesores</p>
                                <p class="text-2xl font-bold text-gray-800" id="total-professors">0</p>
                            </div>
                            <div class="p-3 bg-purple-100 rounded-lg">
                                <i class="fas fa-user-tie text-purple-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex items-center text-sm text-gray-500">
                                <span data-i18n="dashboard.stats.noChanges">Sin cambios</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-card bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-600" data-i18n="dashboard.subjects">Asignaturas</p>
                                <p class="text-2xl font-bold text-gray-800" id="total-subjects">0</p>
                            </div>
                            <div class="p-3 bg-yellow-100 rounded-lg">
                                <i class="fas fa-book text-yellow-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <div class="flex items-center text-sm text-green-500">
                                <i class="fas fa-arrow-up mr-1"></i>
                                <span data-i18n="dashboard.stats.newThisMonth">2 nuevas este mes</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activities and Charts - NUEVO DISEÑO MEJORADO -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Recent Activities - NUEVO DISEÑO -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200 flex flex-col">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-lg font-semibold text-gray-800" data-i18n="dashboard.recentActivities">Actividad Reciente</h2>
                        </div>
                        <div class="space-y-4 flex-1" id="recent-activities">
                            <!-- Las actividades se cargarán dinámicamente -->
                        </div>
                    </div>
                    
                    <!-- Upcoming Practices - NUEVO DISEÑO ADAPTADO -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800 mb-4" data-i18n="dashboard.upcomingPractices">Próximas Prácticas</h2>
                        <div class="space-y-4" id="upcoming-practices">
                            <!-- Las prácticas próximas se cargarán dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Practices View -->
            <div id="practices-view" class="hidden fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800" data-i18n="practices.title">Gestión de Prácticas</h1>
                    <button id="add-practice-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span data-i18n="practices.newPractice">Nueva Práctica</span>
                    </button>
                </div>
                
                <!-- Controles de Interactividad -->
                <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex flex-wrap gap-4 items-center">
                        <!-- Búsqueda -->
                        <div class="flex-1 min-w-[200px]">
                            <label for="search" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="common.search">Buscar</label>
                            <input type="text" id="search" placeholder="Buscar en la tabla..." 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        
                        <!-- Filtro por profesor -->
                        <div class="flex-1 min-w-[200px]">
                            <label for="professor-filter" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="practices.filterByProfessor">Filtrar por profesor</label>
                            <select id="professor-filter" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="" data-i18n="common.all">Todos los profesores</option>
                            </select>
                        </div>
                        
                        <!-- Filtro por estado -->
                        <div class="flex-1 min-w-[200px]">
                            <label for="status-filter" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="practices.filterByStatus">Filtrar por estado</label>
                            <select id="status-filter" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="" data-i18n="common.all">Todos los estados</option>
                                <option value="programada" data-i18n="status.scheduled">Programada</option>
                                <option value="confirmada" data-i18n="status.confirmed">Confirmada</option>
                                <option value="en-curso" data-i18n="status.inProgress">En curso</option>
                                <option value="completada" data-i18n="status.completed">Completada</option>
                                <option value="cancelada" data-i18n="status.cancelled">Cancelada</option>
                            </select>
                        </div>
                        
                        <!-- Botones de acción -->
                        <div class="flex gap-2 items-end">
                            <button id="reset-filters" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors" data-i18n="common.reset">
                                Restablecer
                            </button>
                            <button id="export-pdf-btn" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-green-700 transition-colors" data-i18n="common.exportPDF">
                                Exportar PDF
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Tabla de Prácticas -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto rounded-lg border border-gray-200" id="table-container">
                        <table class="min-w-full divide-y divide-gray-200" id="data-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sortable" data-column="date" scope="col">
                                        <span data-i18n="practices.table.date">FECHA</span>
                                        <span class="sort-icon">↕</span>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sortable" data-column="practice" scope="col">
                                        <span data-i18n="practices.table.practice">PRÁCTICA</span>
                                        <span class="sort-icon">↕</span>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sortable" data-column="professor" scope="col">
                                        <span data-i18n="practices.table.professor">PROFESOR</span>
                                        <span class="sort-icon">↕</span>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sortable" data-column="subject" scope="col">
                                        <span data-i18n="practices.table.subject">ASIGNATURA</span>
                                        <span class="sort-icon">↕</span>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sortable" data-column="status" scope="col">
                                        <span data-i18n="practices.table.status">ESTADO</span>
                                        <span class="sort-icon">↕</span>
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        <span data-i18n="practices.table.actions">ACCIONES</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Los datos se cargarán dinámicamente con JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Información de resultados -->
                    <div class="p-4 border-t border-gray-200 text-sm text-gray-500">
                        <span data-i18n="common.showing">Mostrando</span> <span id="results-count">0</span> <span data-i18n="common.of">de</span> <span id="total-count">0</span> <span data-i18n="practices.practices">prácticas</span>
                    </div>
                </div>
            </div>
            
            <!-- Agenda View - MODIFICADA PARA MOSTRAR POR LABORATORIO -->
            <div id="agenda-view" class="hidden fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800" data-i18n="agenda.title">Agenda - Disponibilidad por Laboratorio</h1>
                    <button id="add-practice-agenda-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span data-i18n="practices.newPractice">Nueva Práctica</span>
                    </button>
                </div>
                
                <!-- Selector de Laboratorio - NUEVO -->
                <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                        <div class="flex-1 min-w-[300px]">
                            <label for="lab-selector" class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-flask mr-2"></i>Seleccionar Laboratorio
                            </label>
                            <select id="lab-selector" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">Seleccione un laboratorio para ver su disponibilidad</option>
                                <!-- Los laboratorios se cargarán dinámicamente -->
                            </select>
                        </div>
                        
                        <div class="flex items-center space-x-4">
                            <div class="text-sm text-gray-600">
                                <div class="flex items-center space-x-2">
                                    <div class="w-4 h-4 bg-green-100 border border-green-500 rounded"></div>
                                    <span>Disponible</span>
                                </div>
                                <div class="flex items-center space-x-2 mt-1">
                                    <div class="w-4 h-4 bg-red-100 border border-red-500 rounded"></div>
                                    <span>Ocupado</span>
                                </div>
                            </div>
                            <button id="refresh-schedule" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors flex items-center gap-2">
                                <i class="fas fa-sync-alt"></i>
                                <span>Actualizar</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Información del laboratorio seleccionado -->
                    <div id="selected-lab-info" class="mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200 hidden">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-800" id="current-lab-name"></h3>
                                <p class="text-sm text-gray-600" id="current-lab-building"></p>
                            </div>
                            <div class="text-sm">
                                <span class="px-2 py-1 bg-primary text-white rounded-full" id="current-lab-practices-count">0 prácticas</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tabla de Disponibilidad - MODIFICADA -->
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                    <div class="schedule-container">
                        <div class="schedule-header">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800" id="schedule-title">Seleccione un laboratorio</h3>
                                <p class="text-sm text-gray-500" id="schedule-subtitle">La tabla mostrará la disponibilidad del laboratorio seleccionado</p>
                            </div>
                            <div class="schedule-legend">
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #fecaca;"></div>
                                    <span class="text-gray-600" data-i18n="agenda.occupied">Ocupado</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #d1fae5;"></div>
                                    <span class="text-gray-600" data-i18n="agenda.available">Disponible</span>
                                </div>
                            </div>
                        </div>
                        
                        <div id="schedule-wrapper" class="schedule-wrapper">
                            <div id="no-lab-selected" class="text-center py-12">
                                <i class="fas fa-flask text-4xl text-gray-300 mb-4"></i>
                                <h4 class="text-lg font-medium text-gray-700 mb-2">Seleccione un laboratorio</h4>
                                <p class="text-gray-500">Por favor, seleccione un laboratorio de la lista para ver su disponibilidad semanal.</p>
                            </div>
                            
                            <table id="schedule-table" class="schedule-table hidden">
                                <thead>
                                    <tr>
                                        <th class="bg-gray-100 text-gray-800" data-i18n="agenda.timeDay">Hora/Día</th>
                                        <th class="bg-gray-100 text-gray-800" data-i18n="days.monday">Lunes</th>
                                        <th class="bg-gray-100 text-gray-800" data-i18n="days.tuesday">Martes</th>
                                        <th class="bg-gray-100 text-gray-800" data-i18n="days.wednesday">Miércoles</th>
                                        <th class="bg-gray-100 text-gray-800" data-i18n="days.thursday">Jueves</th>
                                        <th class="bg-gray-100 text-gray-800" data-i18n="days.friday">Viernes</th>
                                    </tr>
                                </thead>
                                <tbody id="schedule-body-agenda">
                                    <!-- Las celdas se generarán con JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-4 text-sm text-gray-500">
                            <p id="agenda-description" data-i18n="agenda.description">La tabla muestra la disponibilidad del laboratorio seleccionado para la semana actual.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Users View - MODIFICADO: SOLO ADMINISTRADORES Y PROFESORES -->
            <div id="users-view" class="hidden fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800" data-i18n="users.title">Gestión de Usuarios</h1>
                    <button id="add-user-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <i class="fas fa-user-plus"></i>
                        <span data-i18n="users.addUser">Agregar Usuario</span>
                    </button>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200" id="users-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="users.table.user">
                                        Usuario
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="users.table.role">
                                        Rol
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="users.table.email">
                                        Correo
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="users.table.academy">
                                        Academia
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="users.table.status">
                                        Estado
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="users.table.lastAccess">
                                        Último Acceso
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="users.table.actions">
                                        Acciones
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Los datos se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Laboratories View -->
            <div id="laboratories-view" class="hidden fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800" data-i18n="laboratories.title">Gestión de Laboratorios</h1>
                    <button id="add-laboratory-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <i class="fas fa-plus"></i>
                        <span data-i18n="laboratories.addLaboratory">Agregar Laboratorio</span>
                    </button>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200" id="laboratories-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="laboratories.table.name">
                                        Nombre
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="laboratories.table.building">
                                        Edificio
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="laboratories.table.actions">
                                        Acciones
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="laboratories-table-body" class="bg-white divide-y divide-gray-200">
                                <!-- Los datos se cargarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Reports View - MODIFICADO -->
            <div id="reports-view" class="hidden fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h1 class="text-2xl font-bold text-gray-800" data-i18n="reports.title">Reportes de Prácticas</h1>
                    <button id="export-reports-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <i class="fas fa-file-export"></i>
                        <span data-i18n="reports.exportReport">Exportar Reporte</span>
                    </button>
                </div>
                
                <!-- Controles de Filtrado -->
                <div class="mb-6 p-4 bg-white rounded-lg shadow-sm border border-gray-200">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Búsqueda -->
                        <div>
                            <label for="reports-search" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="common.search">Buscar</label>
                            <input type="text" id="reports-search" placeholder="Buscar en la tabla..." 
                                class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                        </div>
                        
                        <!-- Filtro por profesor -->
                        <div>
                            <label for="reports-professor-filter" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="practices.filterByProfessor">Filtrar por profesor</label>
                            <select id="reports-professor-filter" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="" data-i18n="common.all">Todos los profesores</option>
                                <option value="Dr. Fued">Dr. Fued</option>
                                <option value="Prof. Estefano">Prof. Estefano</option>
                                <option value="Prof. Ricardo">Prof. Ricardo</option>
                                <option value="Prof. Valeria">Prof. Valeria</option>
                            </select>
                        </div>
                        
                        <!-- Filtro por estado -->
                        <div>
                            <label for="reports-status-filter" class="block text-sm font-medium text-gray-700 mb-1" data-i18n="practices.filterByStatus">Filtrar por estado</label>
                            <select id="reports-status-filter" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                <option value="" data-i18n="common.all">Todos los estados</option>
                                <option value="programada" data-i18n="status.scheduled">Programada</option>
                                <option value="confirmada" data-i18n="status.confirmed">Confirmada</option>
                                <option value="en-curso" data-i18n="status.inProgress">En curso</option>
                                <option value="completada" data-i18n="status.completed">Completada</option>
                                <option value="cancelada" data-i18n="status.cancelled">Cancelada</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Tabla de Reportes -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table class="min-w-full divide-y divide-gray-200" id="reports-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="practices.table.date">
                                        FECHA
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="practices.table.practice">
                                        PRÁCTICA
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="reports.table.objective">
                                        OBJETIVO
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="practices.table.professor">
                                        PROFESOR
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="practices.table.subject">
                                        ASIGNATURA
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-i18n="practices.table.actions">
                                        ACCIONES
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="reports-table-body">
                                <!-- Las filas se generarán dinámicamente -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Información de resultados -->
                    <div class="p-4 border-t border-gray-200 text-sm text-gray-500">
                        <span data-i18n="common.showing">Mostrando</span> <span id="reports-results-count">0</span> <span data-i18n="common.of">de</span> <span id="reports-total-count">0</span> <span data-i18n="practices.practices">prácticas</span>
                    </div>
                </div>
            </div>
            
            <!-- Settings View - ACTUALIZADA -->
            <div id="settings-view" class="hidden fade-in">
                <h1 class="text-2xl font-bold text-gray-800 mb-6" data-i18n="settings.title">Configuración del Sistema</h1>
                
                <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4" data-i18n="settings.preferences">Preferencias</h2>
                    
                    <form id="settings-form">
                        <div class="space-y-6">
                            <!-- Notificaciones por Email -->
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium text-gray-800" data-i18n="settings.emailNotifications">Notificaciones por Email</p>
                                    <p class="text-sm text-gray-500" data-i18n="settings.emailNotificationsDescription">Recibir notificaciones por correo electrónico</p>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="email-notifications">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <!-- Idioma -->
                            <div>
                                <label for="language" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="settings.language">Idioma</label>
                                <select id="language" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                                    <option value="es">Español</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            
                            <!-- Botón Guardar -->
                            <div class="flex justify-end">
                                <button type="submit" id="save-settings" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors" data-i18n="settings.saveSettings">
                                    Guardar Configuración
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edición de Práctica - MODIFICADO -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="edit-modal-title" data-i18n="practices.editPractice">Editar Práctica</h3>
                    <button id="close-edit-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <form id="edit-practice-form" class="p-6">
                <input type="hidden" id="edit-practice-id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="edit-practice-date" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="practices.form.date">Fecha de Práctica</span> <span class="text-red-500">*</span>
                        </label>
                        <input type="date" id="edit-practice-date" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                    </div>
                    
                    <div>
                        <label for="edit-practice-time" class="block text-sm font-medium text-gray-700 mb-2">
                            <span>Hora de Práctica</span> <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-practice-time" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                            <option value="">Seleccione una hora</option>
                            <option value="7:00">7:00 - 8:00</option>
                            <option value="8:00">8:00 - 9:00</option>
                            <option value="9:00">9:00 - 10:00</option>
                            <option value="10:00">10:00 - 11:00</option>
                            <option value="11:00">11:00 - 12:00</option>
                            <option value="12:00">12:00 - 13:00</option>
                            <option value="13:00">13:00 - 14:00</option>
                            <option value="14:00">14:00 - 15:00</option>
                            <option value="15:00">15:00 - 16:00</option>
                            <option value="16:00">16:00 - 17:00</option>
                            <option value="17:00">17:00 - 18:00</option>
                            <option value="18:00">18:00 - 19:00</option>
                            <option value="19:00">19:00 - 20:00</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label for="edit-practice-name" class="block text-sm font-medium text-gray-700 mb-2">
                        <span data-i18n="practices.form.name">Nombre de Práctica</span> <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="edit-practice-name" required placeholder="Ej: Laboratorio de Química"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="edit-practice-professor" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="practices.form.professor">Profesor</span> <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-practice-professor" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                            <option value="" data-i18n="practices.form.selectProfessor">Seleccione un profesor</option>
                            <option value="Dr. Fued">Dr. Fued</option>
                            <option value="Prof. Estefano">Prof. Estefano</option>
                            <option value="Prof. Ricardo">Prof. Ricardo</option>
                            <option value="Prof. Valeria">Prof. Valeria</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="edit-practice-subject" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="practices.form.subject">Asignatura</span> <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-practice-subject" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                            <option value="" data-i18n="practices.form.selectSubject">Seleccione una asignatura</option>
                            <option value="Programación Concurrente">Programación Concurrente</option>
                            <option value="Sistemas Operativos">Sistemas Operativos</option>
                            <option value="Programación I">Programación I</option>
                            <option value="Liderazgo eq. Alto desempeño">Liderazgo eq. Alto desempeño</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label for="edit-practice-objective" class="block text-sm font-medium text-gray-700 mb-2">
                        <span data-i18n="practices.form.objective">Objetivo de la Práctica</span> <span class="text-red-500">*</span>
                    </label>
                    <textarea id="edit-practice-objective" required rows="3" placeholder="Describa el objetivo principal de esta práctica..."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors"></textarea>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="edit-practice-lab" class="block text-sm font-medium text-gray-700 mb-2" data-i18n="practices.form.lab">
                            Laboratorio / Aula <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-practice-lab" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                            <option value="">Seleccione un laboratorio</option>
                            <!-- Los laboratorios se cargarán dinámicamente -->
                        </select>
                    </div>
                    
                    <div>
                        <label for="edit-practice-status" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="practices.form.status">Estado</span> <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-practice-status" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                            <option value="programada" data-i18n="status.scheduled">Programada</option>
                            <option value="confirmada" data-i18n="status.confirmed">Confirmada</option>
                            <option value="en-curso" data-i18n="status.inProgress">En curso</option>
                            <option value="completada" data-i18n="status.completed">Completada</option>
                            <option value="cancelada" data-i18n="status.cancelled">Cancelada</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                    <button type="button" id="cancel-edit" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors" data-i18n="common.cancel">
                        Cancelar
                    </button>
                    <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <i class="fas fa-save"></i>
                        <span data-i18n="common.saveChanges">Guardar Cambios</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Eliminación de Práctica -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" data-i18n="practices.confirmDelete">Confirmar Eliminación</h3>
                    <button id="close-delete-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="p-3 bg-red-100 rounded-full">
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800" data-i18n="practices.deleteConfirmation">¿Está seguro de eliminar esta práctica?</h4>
                        <p class="text-sm text-gray-500 mt-1" data-i18n="practices.deleteWarning">Esta acción no se puede deshacer.</p>
                    </div>
                </div>
                
                <div class="bg-red-50 p-4 rounded-lg mb-6">
                    <p class="text-sm text-gray-800 font-medium" id="delete-practice-name"></p>
                    <p class="text-xs text-gray-500 mt-1" id="delete-practice-details"></p>
                </div>
                
                <input type="hidden" id="delete-practice-id">
                
                <div class="flex justify-end gap-3">
                    <button type="button" id="cancel-delete" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors" data-i18n="common.cancel">
                        Cancelar
                    </button>
                    <button type="button" id="confirm-delete" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex items-center gap-2">
                        <i class="fas fa-trash"></i>
                        <span data-i18n="practices.deletePractice">Eliminar Práctica</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edición de Usuario - MODIFICADO: SOLO ADMINISTRADORES Y PROFESORES -->
    <div id="edit-user-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="edit-user-modal-title" data-i18n="users.editUser">Editar Usuario</h3>
                    <button id="close-edit-user-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <form id="edit-user-form" class="p-6">
                <input type="hidden" id="edit-user-id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="edit-user-name" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="users.form.fullName">Nombre Completo</span> <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="edit-user-name" required placeholder="Ej: Juan Pérez"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                    </div>
                    
                    <div>
                        <label for="edit-user-username" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="users.form.username">Usuario</span> <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="edit-user-username" required placeholder="Ej: juanperez"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="edit-user-email" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="users.form.email">Correo Electrónico</span> <span class="text-red-500">*</span>
                        </label>
                        <input type="email" id="edit-user-email" required placeholder="Ej: juan@universidad.edu"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                    </div>
                    
                    <div>
                        <label for="edit-user-role" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="users.form.role">Rol</span> <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-user-role" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                            <option value="" data-i18n="users.form.selectRole">Seleccione un rol</option>
                            <option value="Administrador" data-i18n="roles.admin">Administrador</option>
                            <option value="Profesor" data-i18n="roles.teacher">Profesor</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="edit-user-academy" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="users.form.academy">Academia</span>
                        </label>
                        <select id="edit-user-academy"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                            <option value="">Seleccione una academia</option>
                            <option value="Academia en Software">Academia en Software</option>
                            <option value="Academia en Sistemas">Academia en Sistemas</option>
                            <option value="Academia en Redes">Academia en Redes</option>
                            <option value="Academia en Base de Datos">Academia en Base de Datos</option>
                            <option value="Academia en Inteligencia Artificial">Academia en Inteligencia Artificial</option>
                            <option value="Academia en Seguridad Informática">Academia en Seguridad Informática</option>
                            <option value="Academia en Desarrollo Web">Academia en Desarrollo Web</option>
                            <option value="Academia en Móviles">Academia en Móviles</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="edit-user-status" class="block text-sm font-medium text-gray-700 mb-2">
                            <span data-i18n="users.form.status">Estado</span> <span class="text-red-500">*</span>
                        </label>
                        <select id="edit-user-status" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                            <option value="Activo" data-i18n="status.active">Activo</option>
                            <option value="Inactivo" data-i18n="status.inactive">Inactivo</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                    <button type="button" id="cancel-edit-user" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors" data-i18n="common.cancel">
                        Cancelar
                    </button>
                    <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <i class="fas fa-save"></i>
                        <span data-i18n="common.saveChanges">Guardar Cambios</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Eliminación de Usuario -->
    <div id="delete-user-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" data-i18n="users.confirmDelete">Confirmar Eliminación</h3>
                    <button id="close-delete-user-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="p-3 bg-red-100 rounded-full">
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800" data-i18n="users.deleteConfirmation">¿Está seguro de eliminar este usuario?</h4>
                        <p class="text-sm text-gray-500 mt-1" data-i18n="users.deleteWarning">Esta acción no se puede deshacer.</p>
                    </div>
                </div>
                
                <div class="bg-red-50 p-4 rounded-lg mb-6">
                    <p class="text-sm text-gray-800 font-medium" id="delete-user-name"></p>
                    <p class="text-xs text-gray-500 mt-1" id="delete-user-details"></p>
                </div>
                
                <input type="hidden" id="delete-user-id">
                
                <div class="flex justify-end gap-3">
                    <button type="button" id="cancel-delete-user" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors" data-i18n="common.cancel">
                        Cancelar
                    </button>
                    <button type="button" id="confirm-delete-user" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex items-center gap-2">
                        <i class="fas fa-trash"></i>
                        <span data-i18n="users.deleteUser">Eliminar Usuario</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edición de Laboratorio -->
    <div id="edit-laboratory-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" id="edit-laboratory-modal-title" data-i18n="laboratories.editLaboratory">Editar Laboratorio</h3>
                    <button id="close-edit-laboratory-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <form id="edit-laboratory-form" class="p-6">
                <input type="hidden" id="edit-laboratory-id">
                
                <div class="mb-6">
                    <label for="edit-laboratory-name" class="block text-sm font-medium text-gray-700 mb-2">
                        <span data-i18n="laboratories.form.name">Nombre del Laboratorio</span> <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="edit-laboratory-name" required placeholder="Ej: Laboratorio de Química"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                </div>
                
                <div class="mb-6">
                    <label for="edit-laboratory-building" class="block text-sm font-medium text-gray-700 mb-2">
                        <span data-i18n="laboratories.form.building">Edificio</span> <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="edit-laboratory-building" required placeholder="Ej: Edificio de Ciencias"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                </div>
                
                <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                    <button type="button" id="cancel-edit-laboratory" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors" data-i18n="common.cancel">
                        Cancelar
                    </button>
                    <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2">
                        <i class="fas fa-save"></i>
                        <span data-i18n="common.saveChanges">Guardar Cambios</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Eliminación de Laboratorio -->
    <div id="delete-laboratory-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" data-i18n="laboratories.confirmDelete">Confirmar Eliminación</h3>
                    <button id="close-delete-laboratory-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="flex items-center gap-4 mb-4">
                    <div class="p-3 bg-red-100 rounded-full">
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800" data-i18n="laboratories.deleteConfirmation">¿Está seguro de eliminar este laboratorio?</h4>
                        <p class="text-sm text-gray-500 mt-1" data-i18n="laboratories.deleteWarning">Esta acción no se puede deshacer.</p>
                    </div>
                </div>
                
                <div class="bg-red-50 p-4 rounded-lg mb-6">
                    <p class="text-sm text-gray-800 font-medium" id="delete-laboratory-name"></p>
                    <p class="text-xs text-gray-500 mt-1" id="delete-laboratory-details"></p>
                </div>
                
                <input type="hidden" id="delete-laboratory-id">
                
                <div class="flex justify-end gap-3">
                    <button type="button" id="cancel-delete-laboratory" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors" data-i18n="common.cancel">
                        Cancelar
                    </button>
                    <button type="button" id="confirm-delete-laboratory" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex items-center gap-2">
                        <i class="fas fa-trash"></i>
                        <span data-i18n="laboratories.deleteLaboratory">Eliminar Laboratorio</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Cerrar Sesión - ADAPTADO DEL CÓDIGO MÁS PEQUEÑO -->
    <div id="logout-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden fade-in">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 slide-in">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800" data-i18n="menu.logout">Cerrar Sesión</h3>
                    <button id="close-logout-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <div class="p-6">
                <div class="flex items-center justify-center mb-4">
                    <div class="w-16 h-16 rounded-full bg-blue-100 flex items-center justify-center">
                        <i class="fas fa-sign-out-alt text-blue-500 text-2xl"></i>
                    </div>
                </div>
                <p class="text-center text-gray-600 mb-6" data-i18n="logout.confirmation">
                    ¿Está seguro de que desea cerrar sesión?
                </p>
                
                <div class="flex justify-end gap-3 pt-4">
                    <button id="cancel-logout" class="px-6 py-3 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors" data-i18n="common.cancel">
                        Cancelar
                    </button>
                    <button id="confirm-logout" class="px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex items-center gap-2">
                        <i class="fas fa-sign-out-alt"></i>
                        <span data-i18n="menu.logout">Cerrar Sesión</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mensaje de éxito -->
    <div id="success-message" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 hidden fade-in">
        <div class="flex items-center gap-2">
            <i class="fas fa-check-circle"></i>
            <span id="success-text">¡Operación completada exitosamente!</span>
        </div>
    </div>

    <script>
        // Estado de configuración
        const appSettings = {
            emailNotifications: true,
            language: 'es'
        };

        // Estado temporal de configuración (para cambios no guardados)
        let tempSettings = {...appSettings};

        // Diccionario de traducciones - MODIFICADO: REMOVIDO ESTUDIANTE
        const translations = {
            es: {
                // Header
                "header.admin": "Administrador",
                
                // Menú
                "menu.title": "Menú",
                "menu.dashboard": "Dashboard",
                "menu.practices": "Prácticas",
                "menu.agenda": "Agenda",
                "menu.users": "Usuarios",
                "menu.laboratories": "Laboratorios",
                "menu.reports": "Reportes",
                "menu.settings": "Configuración",
                "menu.profile": "Perfil",
                "menu.logout": "Cerrar Sesión",
                
                // Universidad
                "university.line1": "Universidad Politécnica de",
                "university.line2": "Durango",
                
                // Dashboard
                "dashboard.title": "Dashboard de Administración",
                "dashboard.totalPractices": "Total Prácticas",
                "dashboard.monthPractices": "Prácticas Este Mes",
                "dashboard.professors": "Profesores",
                "dashboard.subjects": "Asignaturas",
                "dashboard.stats.increase": "12% más que el mes pasado",
                "dashboard.stats.weeklyIncrease": "5% más que la semana pasada",
                "dashboard.stats.noChanges": "Sin cambios",
                "dashboard.stats.newThisMonth": "2 nuevas este mes",
                "dashboard.recentActivities": "Actividad Reciente",
                "dashboard.upcomingPractices": "Próximas Prácticas",
                
                // Prácticas
                "practices.title": "Gestión de Prácticas",
                "practices.newPractice": "Nueva Práctica",
                "practices.filterByProfessor": "Filtrar por profesor",
                "practices.filterByStatus": "Filtrar por estado",
                "practices.table.date": "FECHA",
                "practices.table.practice": "PRÁCTICA",
                "practices.table.professor": "PROFESOR",
                "practices.table.subject": "ASIGNATURA",
                "practices.table.status": "ESTADO",
                "practices.table.actions": "ACCIONES",
                "practices.practices": "prácticas",
                "practices.form.date": "Fecha de Práctica",
                "practices.form.name": "Nombre de Práctica",
                "practices.form.professor": "Profesor",
                "practices.form.selectProfessor": "Seleccione un profesor",
                "practices.form.subject": "Asignatura",
                "practices.form.selectSubject": "Seleccione una asignatura",
                "practices.form.objective": "Objetivo de la Práctica",
                "practices.form.lab": "Laboratorio / Aula",
                "practices.form.status": "Estado",
                "practices.editPractice": "Editar Práctica",
                "practices.confirmDelete": "Confirmar Eliminación",
                "practices.deleteConfirmation": "¿Está seguro de eliminar esta práctica?",
                "practices.deleteWarning": "Esta acción no se puede deshacer.",
                "practices.deletePractice": "Eliminar Práctica",
                
                // Agenda
                "agenda.title": "Agenda - Disponibilidad",
                "agenda.weeklyAvailability": "Disponibilidad Semanal",
                "agenda.occupied": "Ocupado",
                "agenda.available": "Disponible",
                "agenda.timeDay": "Hora/Día",
                "agenda.description": "La tabla muestra la disponibilidad de los laboratorios para la semana actual.",
                
                // Días de la semana
                "days.monday": "Lunes",
                "days.tuesday": "Martes",
                "days.wednesday": "Miércoles",
                "days.thursday": "Jueves",
                "days.friday": "Viernes",
                
                // Estados
                "status.scheduled": "Programada",
                "status.confirmed": "Confirmada",
                "status.inProgress": "En curso",
                "status.completed": "Completada",
                "status.cancelled": "Cancelada",
                "status.active": "Activo",
                "status.inactive": "Inactivo",
                
                // Usuarios - MODIFICADO: AGREGADO CAMPO ACADEMIA
                "users.title": "Gestión de Usuarios",
                "users.addUser": "Agregar Usuario",
                "users.table.user": "Usuario",
                "users.table.role": "Rol",
                "users.table.email": "Correo",
                "users.table.academy": "Academia",
                "users.table.status": "Estado",
                "users.table.lastAccess": "Último Acceso",
                "users.table.actions": "Acciones",
                "users.editUser": "Editar Usuario",
                "users.confirmDelete": "Confirmar Eliminación",
                "users.deleteConfirmation": "¿Está seguro de eliminar este usuario?",
                "users.deleteWarning": "Esta acción no se puede deshacer.",
                "users.deleteUser": "Eliminar Usuario",
                "users.form.fullName": "Nombre Completo",
                "users.form.username": "Usuario",
                "users.form.email": "Correo Electrónico",
                "users.form.role": "Rol",
                "users.form.selectRole": "Seleccione un rol",
                "users.form.academy": "Academia",
                "users.form.status": "Estado",
                
                // Laboratorios
                "laboratories.title": "Gestión de Laboratorios",
                "laboratories.addLaboratory": "Agregar Laboratorio",
                "laboratories.table.name": "Nombre",
                "laboratories.table.building": "Edificio",
                "laboratories.table.actions": "Acciones",
                "laboratories.editLaboratory": "Editar Laboratorio",
                "laboratories.confirmDelete": "Confirmar Eliminación",
                "laboratories.deleteConfirmation": "¿Está seguro de eliminar este laboratorio?",
                "laboratories.deleteWarning": "Esta acción no se puede deshacer.",
                "laboratories.deleteLaboratory": "Eliminar Laboratorio",
                "laboratories.form.name": "Nombre del Laboratorio",
                "laboratories.form.building": "Edificio",
                
                // Reportes
                "reports.title": "Reportes de Prácticas",
                "reports.exportReport": "Exportar Reporte",
                "reports.table.objective": "OBJETIVO",
                
                // Configuración
                "settings.title": "Configuración del Sistema",
                "settings.preferences": "Preferencias",
                "settings.emailNotifications": "Notificaciones por Email",
                "settings.emailNotificationsDescription": "Recibir notificaciones por correo electrónico",
                "settings.language": "Idioma",
                "settings.saveSettings": "Guardar Configuración",
                
                // Común
                "common.search": "Buscar",
                "common.all": "Todos",
                "common.reset": "Restablecer",
                "common.exportPDF": "Exportar PDF",
                "common.showing": "Mostrando",
                "common.of": "de",
                "common.cancel": "Cancelar",
                "common.saveChanges": "Guardar Cambios",
                
                // Roles - MODIFICADO: SOLO ADMINISTRADOR Y PROFESOR
                "roles.admin": "Administrador",
                "roles.teacher": "Profesor",
                
                // Logout
                "logout.confirmation": "¿Está seguro de que desea cerrar sesión?"
            },
            en: {
                // Header
                "header.admin": "Administrator",
                
                // Menú
                "menu.title": "Menu",
                "menu.dashboard": "Dashboard",
                "menu.practices": "Practices",
                "menu.agenda": "Agenda",
                "menu.users": "Users",
                "menu.laboratories": "Laboratories",
                "menu.reports": "Reports",
                "menu.settings": "Settings",
                "menu.profile": "Profile",
                "menu.logout": "Logout",
                
                // Universidad
                "university.line1": "Polytechnic University of",
                "university.line2": "Durango",
                
                // Dashboard
                "dashboard.title": "Administration Dashboard",
                "dashboard.totalPractices": "Total Practices",
                "dashboard.monthPractices": "This Month Practices",
                "dashboard.professors": "Professors",
                "dashboard.subjects": "Subjects",
                "dashboard.stats.increase": "12% more than last month",
                "dashboard.stats.weeklyIncrease": "5% more than last week",
                "dashboard.stats.noChanges": "No changes",
                "dashboard.stats.newThisMonth": "2 new this month",
                "dashboard.recentActivities": "Recent Activities",
                "dashboard.upcomingPractices": "Upcoming Practices",
                
                // Prácticas
                "practices.title": "Practice Management",
                "practices.newPractice": "New Practice",
                "practices.filterByProfessor": "Filter by professor",
                "practices.filterByStatus": "Filter by status",
                "practices.table.date": "DATE",
                "practices.table.practice": "PRACTICE",
                "practices.table.professor": "PROFESSOR",
                "practices.table.subject": "SUBJECT",
                "practices.table.status": "STATUS",
                "practices.table.actions": "ACTIONS",
                "practices.practices": "practices",
                "practices.form.date": "Practice Date",
                "practices.form.name": "Practice Name",
                "practices.form.professor": "Professor",
                "practices.form.selectProfessor": "Select a professor",
                "practices.form.subject": "Subject",
                "practices.form.selectSubject": "Select a subject",
                "practices.form.objective": "Practice Objective",
                "practices.form.lab": "Laboratory / Classroom",
                "practices.form.status": "Status",
                "practices.editPractice": "Edit Practice",
                "practices.confirmDelete": "Confirm Deletion",
                "practices.deleteConfirmation": "Are you sure you want to delete this practice?",
                "practices.deleteWarning": "This action cannot be undone.",
                "practices.deletePractice": "Delete Practice",
                
                // Agenda
                "agenda.title": "Agenda - Availability",
                "agenda.weeklyAvailability": "Weekly Availability",
                "agenda.occupied": "Occupied",
                "agenda.available": "Available",
                "agenda.timeDay": "Time/Day",
                "agenda.description": "The table shows laboratory availability for the current week.",
                
                // Días de la semana
                "days.monday": "Monday",
                "days.tuesday": "Tuesday",
                "days.wednesday": "Wednesday",
                "days.thursday": "Thursday",
                "days.friday": "Friday",
                
                // Estados
                "status.scheduled": "Scheduled",
                "status.confirmed": "Confirmed",
                "status.inProgress": "In Progress",
                "status.completed": "Completed",
                "status.cancelled": "Cancelled",
                "status.active": "Active",
                "status.inactive": "Inactive",
                
                // Usuarios - MODIFICADO: AGREGADO CAMPO ACADEMIA
                "users.title": "User Management",
                "users.addUser": "Add User",
                "users.table.user": "User",
                "users.table.role": "Role",
                "users.table.email": "Email",
                "users.table.academy": "Academy",
                "users.table.status": "Status",
                "users.table.lastAccess": "Last Access",
                "users.table.actions": "Actions",
                "users.editUser": "Edit User",
                "users.confirmDelete": "Confirm Deletion",
                "users.deleteConfirmation": "Are you sure you want to delete this user?",
                "users.deleteWarning": "This action cannot be undone.",
                "users.deleteUser": "Delete User",
                "users.form.fullName": "Full Name",
                "users.form.username": "Username",
                "users.form.email": "Email",
                "users.form.role": "Role",
                "users.form.selectRole": "Select a role",
                "users.form.academy": "Academy",
                "users.form.status": "Status",
                
                // Laboratorios
                "laboratories.title": "Laboratories Management",
                "laboratories.addLaboratory": "Add Laboratory",
                "laboratories.table.name": "Name",
                "laboratories.table.building": "Building",
                "laboratories.table.actions": "Actions",
                "laboratories.editLaboratory": "Edit Laboratory",
                "laboratories.confirmDelete": "Confirm Deletion",
                "laboratories.deleteConfirmation": "Are you sure you want to delete this laboratory?",
                "laboratories.deleteWarning": "This action cannot be undone.",
                "laboratories.deleteLaboratory": "Delete Laboratory",
                "laboratories.form.name": "Laboratory Name",
                "laboratories.form.building": "Building",
                
                // Reportes
                "reports.title": "Practice Reports",
                "reports.exportReport": "Export Report",
                "reports.table.objective": "OBJECTIVE",
                
                // Configuración
                "settings.title": "System Settings",
                "settings.preferences": "Preferences",
                "settings.emailNotifications": "Email Notifications",
                "settings.emailNotificationsDescription": "Receive email notifications",
                "settings.language": "Language",
                "settings.saveSettings": "Save Settings",
                
                // Común
                "common.search": "Search",
                "common.all": "All",
                "common.reset": "Reset",
                "common.exportPDF": "Export PDF",
                "common.showing": "Showing",
                "common.of": "of",
                "common.cancel": "Cancel",
                "common.saveChanges": "Save Changes",
                
                // Roles - MODIFICADO: SOLO ADMINISTRADOR Y PROFESOR
                "roles.admin": "Administrator",
                "roles.teacher": "Professor",
                
                // Logout
                "logout.confirmation": "Are you sure you want to log out?"
            }
        };

        // Datos de ejemplo actualizados para la tabla de prácticas - CORREGIDOS
        let practiceData = [
            { 
                id: 1, 
                date: '2024-01-15', // Lunes
                practice: 'Laboratorio MAC', 
                professor: 'Dr. Fued', 
                subject: 'Programación Concurrente', 
                status: 'programada', 
                time: '7:00',
                objective: 'Programación de hilos en web.',
                lab: 'Laboratorio de Computación',
                labId: 3,
                labName: 'Laboratorio de Computación'
            },
            { 
                id: 2, 
                date: '2024-01-15', // Lunes
                practice: 'Laboratorio Linux', 
                professor: 'Prof. Estefano', 
                subject: 'Sistemas Operativos', 
                status: 'confirmada', 
                time: '9:00',
                objective: 'Instalación de un sistema operativo dual.',
                lab: 'Laboratorio de Computación',
                labId: 3,
                labName: 'Laboratorio de Computación'
            },
            { 
                id: 3, 
                date: '2024-01-16', // Martes
                practice: 'Laboratorio Windows', 
                professor: 'Prof. Ricardo', 
                subject: 'Programación I', 
                status: 'en-curso', 
                time: '11:00',
                objective: 'Instalación de un sistema operativo dual.',
                lab: 'Laboratorio de Física',
                labId: 2,
                labName: 'Laboratorio de Física'
            },
            { 
                id: 4, 
                date: '2024-01-17', // Miércoles
                practice: 'Laboratorio Windows', 
                professor: 'Prof. Valeria', 
                subject: 'Liderazgo eq. Alto desempeño', 
                status: 'cancelada', 
                time: '14:00',
                objective: 'Examen de conocimientos.',
                lab: 'Aula 4',
                labId: 4,
                labName: 'Aula 4'
            },
            { 
                id: 5, 
                date: '2024-01-18', // Jueves
                practice: 'Laboratorio Windows', 
                professor: 'Prof. Valeria', 
                subject: 'Liderazgo eq. Alto desempeño', 
                status: 'completada', 
                time: '16:00',
                objective: 'En cuesta de...',
                lab: 'Aula 4',
                labId: 4,
                labName: 'Aula 4'
            }
        ];

        // Datos de ejemplo para usuarios - MODIFICADO: SOLO ADMINISTRADORES Y PROFESORES CON ACADEMIA
        let usersData = [
            { 
                id: 1, 
                name: 'Administrador', 
                username: 'admin', 
                email: 'admin@universidad.edu', 
                role: 'Administrador', 
                academy: '', // Los administradores no tienen academia
                status: 'Activo', 
                lastAccess: 'Hoy, 10:30 AM' 
            },
            { 
                id: 2, 
                name: 'Dr. Fued', 
                username: 'fued', 
                email: 'fued@universidad.edu', 
                role: 'Profesor', 
                academy: 'Academia en Software',
                status: 'Activo', 
                lastAccess: 'Hoy, 09:15 AM' 
            },
            { 
                id: 3, 
                name: 'Prof. Estefano', 
                username: 'estefano', 
                email: 'estefano@universidad.edu', 
                role: 'Profesor', 
                academy: 'Academia en Sistemas',
                status: 'Activo', 
                lastAccess: 'Ayer, 16:45 PM' 
            },
            { 
                id: 4, 
                name: 'Prof. Ricardo', 
                username: 'ricardo', 
                email: 'ricardo@universidad.edu', 
                role: 'Profesor', 
                academy: 'Academia en Redes',
                status: 'Activo', 
                lastAccess: 'Hoy, 11:20 AM' 
            },
            { 
                id: 5, 
                name: 'Prof. Valeria', 
                username: 'valeria', 
                email: 'valeria@universidad.edu', 
                role: 'Profesor', 
                academy: 'Academia en Inteligencia Artificial',
                status: 'Activo', 
                lastAccess: 'Ayer, 14:30 PM' 
            }
        ];

        // Datos de ejemplo para laboratorios
        let laboratoriesData = [
            { id: 1, name: 'Laboratorio de Química', building: 'Edificio de Ciencias' },
            { id: 2, name: 'Laboratorio de Física', building: 'Edificio de Ciencias' },
            { id: 3, name: 'Laboratorio de Computación', building: 'Edificio Tecnológico' },
            { id: 4, name: 'Aula 4', building: 'Edificio Principal' }
        ];

        // Datos de ejemplo para reportes
        let reportsData = [
            { id: 1, date: '2024-01-15', practice: 'Laboratorio MAC', objective: 'Programación de hilos en web.', professor: 'Dr. Fued', subject: 'Programación Concurrente' },
            { id: 2, date: '2024-01-15', practice: 'Laboratorio Linux', objective: 'Instalación de un sistema operativo dual.', professor: 'Prof. Estefano', subject: 'Sistemas Operativos' },
            { id: 3, date: '2024-01-16', practice: 'Laboratorio Windows', objective: 'Instalación de un sistema operativo dual.', professor: 'Prof. Ricardo', subject: 'Programación I' },
            { id: 4, date: '2024-01-17', practice: 'Laboratorio Windows', objective: 'Examen de conocimientos.', professor: 'Prof. Valeria', subject: 'Liderazgo eq. Alto desempeño' },
            { id: 5, date: '2024-01-18', practice: 'Laboratorio Windows', objective: 'En cuesta de...', professor: 'Prof. Valeria', subject: 'Liderazgo eq. Alto desempeño' }
        ];

        // Estado de la aplicación
        let currentData = [...practiceData];
        let currentReportsData = [...reportsData];
        let sortColumn = 'date';
        let sortDirection = 'asc';
        let currentFilters = {
            search: '',
            professor: '',
            status: ''
        };
        let currentReportsFilters = {
            search: '',
            professor: '',
            status: ''
        };

        // Estado para la agenda por laboratorio
        let selectedLabId = null;
        let labOccupancy = {}; // {labId: {day: {hour: practiceInfo}}}

        // Funciones para el modal de cerrar sesión - ADAPTADAS DEL CÓDIGO MÁS PEQUEÑO
        function abrirModalCerrarSesion() {
            const modal = document.getElementById('logout-modal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                // Oscurecer el header
                document.getElementById('header-container').classList.add('modal-open');
            }
        }

        function cerrarModalCerrarSesion() {
            const modal = document.getElementById('logout-modal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                // Restaurar el header
                document.getElementById('header-container').classList.remove('modal-open');
            }
        }

        function confirmarCerrarSesion() {
            if (confirm('¿Está seguro de que desea cerrar sesión?')) {
                alert('Cerrando sesión...');
                // window.location.href = 'login.html';
                cerrarModalCerrarSesion();
            }
        }

        // Inicialización - CORREGIDA
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar listeners para el modal de cerrar sesión - ADAPTADO DEL CÓDIGO MÁS PEQUEÑO
            const closeLogoutModal = document.getElementById('close-logout-modal');
            const cancelLogout = document.getElementById('cancel-logout');
            const confirmLogout = document.getElementById('confirm-logout');
            const logoutModal = document.getElementById('logout-modal');
            
            if (closeLogoutModal) {
                closeLogoutModal.addEventListener('click', cerrarModalCerrarSesion);
            }
            if (cancelLogout) {
                cancelLogout.addEventListener('click', cerrarModalCerrarSesion);
            }
            if (confirmLogout) {
                confirmLogout.addEventListener('click', confirmarCerrarSesion);
            }
            if (logoutModal) {
                logoutModal.addEventListener('click', function(e) {
                    if (e.target === logoutModal) {
                        cerrarModalCerrarSesion();
                    }
                });
            }
            
            // Primero cargar configuración para aplicar modo oscuro e idioma
            loadSettings();
            
            // Luego inicializar el resto de la aplicación
            initializeDashboard();
            initializePracticesTable();
            initializeUsersTable();
            initializeLaboratoriesTable();
            initializeReportsTable();
            setupEventListeners();
            updateResultsCount();
            updateReportsResultsCount();
            
            // Configurar menú hamburguesa y modales del header
            setupHeaderFunctionality();
            setupUserModalListeners();
            setupModalListeners();
            
            // Configurar listeners de configuración
            setupSettingsListeners();
            
            // Mostrar Dashboard por defecto
            showView('dashboard-view');
            
            // Cargar las nuevas vistas de actividades y prácticas
            loadRecentActivities();
            loadUpcomingPractices();
            
            // Inicializar selector de laboratorios para agenda
            initializeLabSelector();
        });

        // Cargar configuración guardada
        function loadSettings() {
            const savedSettings = localStorage.getItem('appSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                appSettings.emailNotifications = settings.emailNotifications;
                appSettings.language = settings.language;
                tempSettings = {...appSettings}; // Inicializar tempSettings con los valores guardados
            } else {
                tempSettings = {...appSettings}; // Inicializar tempSettings con valores por defecto
            }

            // Aplicar configuración
            applySettings();
        }

        // Aplicar configuración a la interfaz
        function applySettings() {
            // Actualizar controles con los valores guardados (no los temporales)
            const emailNotificationsToggle = document.getElementById('email-notifications');
            const languageSelect = document.getElementById('language');
            
            if (emailNotificationsToggle) emailNotificationsToggle.checked = appSettings.emailNotifications;
            if (languageSelect) languageSelect.value = appSettings.language;
            
            // Aplicar traducciones
            applyTranslations(appSettings.language);
        }

        // Aplicar traducciones
        function applyTranslations(language) {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[language] && translations[language][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[language][key];
                    } else {
                        element.textContent = translations[language][key];
                    }
                }
            });
        }

        // Configurar listeners de configuración
        function setupSettingsListeners() {
            // Notificaciones por email
            const emailNotificationsToggle = document.getElementById('email-notifications');
            if (emailNotificationsToggle) {
                emailNotificationsToggle.addEventListener('change', function() {
                    // Solo actualizar tempSettings, no appSettings
                    tempSettings.emailNotifications = this.checked;
                });
            }

            // Idioma
            const languageSelect = document.getElementById('language');
            if (languageSelect) {
                languageSelect.addEventListener('change', function() {
                    // Solo actualizar tempSettings, no appSettings
                    tempSettings.language = this.value;
                });
            }

            // Guardar configuración - AHORA ES UN FORMULARIO
            const settingsForm = document.getElementById('settings-form');
            if (settingsForm) {
                settingsForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Actualizar appSettings con tempSettings
                    appSettings.emailNotifications = tempSettings.emailNotifications;
                    appSettings.language = tempSettings.language;
                    
                    // Guardar en localStorage
                    saveSettings();
                    
                    // Aplicar cambios inmediatamente
                    applySettings();
                    
                    showSuccessMessage('Configuración guardada correctamente');
                });
            }
        }

        // Guardar configuración
        function saveSettings() {
            localStorage.setItem('appSettings', JSON.stringify(appSettings));
        }

        // Configurar funcionalidades del header
        function setupHeaderFunctionality() {
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const mobileMenu = document.getElementById('mobile-menu');
            const userInitialsBtn = document.getElementById('user-initials-btn');

            // Menú hamburguesa
            if (hamburgerMenu && mobileMenu) {
                hamburgerMenu.addEventListener('click', function() {
                    mobileMenu.classList.toggle('active');
                    hamburgerMenu.classList.toggle('active');
                });
                
                // Cerrar menú al hacer clic fuera de él
                document.addEventListener('click', function(event) {
                    if (!hamburgerMenu.contains(event.target) && !mobileMenu.contains(event.target)) {
                        mobileMenu.classList.remove('active');
                        hamburgerMenu.classList.remove('active');
                    }
                });
            }

            // Botón de iniciales del usuario - QUITADA LA FUNCIÓN DE CERRAR SESIÓN
            if (userInitialsBtn) {
                userInitialsBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Función eliminada - ya no abre el modal de cerrar sesión
                    console.log("Inicial del usuario clickeada - función deshabilitada");
                });
            }
        }

        // Configurar listeners para modales de usuario
        function setupUserModalListeners() {
            const addUserBtn = document.getElementById('add-user-btn');
            
            // Botón para agregar usuario
            if (addUserBtn) {
                addUserBtn.addEventListener('click', function() {
                    openNewUserModal();
                });
            }
        }

        // Abrir modal para nuevo usuario
        function openNewUserModal() {
            // Limpiar el formulario
            document.getElementById('edit-user-form').reset();
            document.getElementById('edit-user-id').value = '';
            
            // Cambiar título del modal
            document.getElementById('edit-user-modal-title').textContent = 'Agregar Usuario';
            
            // Mostrar modal
            const editUserModal = document.getElementById('edit-user-modal');
            editUserModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Abrir modal para editar usuario - MODIFICADO: AGREGADO ACADEMIA
        function openEditUserModal(userId) {
            const user = usersData.find(u => u.id === userId);
            if (!user) return;
            
            // Llenar el formulario con los datos actuales
            document.getElementById('edit-user-id').value = user.id;
            document.getElementById('edit-user-name').value = user.name;
            document.getElementById('edit-user-username').value = user.username;
            document.getElementById('edit-user-email').value = user.email;
            document.getElementById('edit-user-role').value = user.role;
            document.getElementById('edit-user-academy').value = user.academy || '';
            document.getElementById('edit-user-status').value = user.status;
            
            // Cambiar título del modal
            document.getElementById('edit-user-modal-title').textContent = 'Editar Usuario';
            
            // Mostrar modal
            const editUserModal = document.getElementById('edit-user-modal');
            editUserModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Abrir modal para eliminar usuario
        function openDeleteUserModal(userId, userName) {
            // Llenar la información del usuario a eliminar
            document.getElementById('delete-user-id').value = userId;
            document.getElementById('delete-user-name').textContent = userName;
            document.getElementById('delete-user-details').textContent = `Usuario: ${userName}`;
            
            // Mostrar modal
            const deleteUserModal = document.getElementById('delete-user-modal');
            deleteUserModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Función para mostrar perfil
        function mostrarPerfil() {
            alert('Perfil de usuario');
            const mobileMenu = document.getElementById('mobile-menu');
            const hamburgerMenu = document.getElementById('hamburger-menu');
            if (mobileMenu) mobileMenu.classList.remove('active');
            if (hamburgerMenu) hamburgerMenu.classList.remove('active');
        }

        // Cerrar menú móvil
        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const hamburgerMenu = document.getElementById('hamburger-menu');
            if (mobileMenu) mobileMenu.classList.remove('active');
            if (hamburgerMenu) hamburgerMenu.classList.remove('active');
        }

        // Hacer las funciones globales
        window.mostrarPerfil = mostrarPerfil;
        window.abrirModalCerrarSesion = abrirModalCerrarSesion;
        window.cerrarModalCerrarSesion = cerrarModalCerrarSesion;
        window.confirmarCerrarSesion = confirmarCerrarSesion;
        window.closeMobileMenu = closeMobileMenu;

        // Inicializar dashboard
        function initializeDashboard() {
            updateDashboardStats();
            loadRecentActivities();
            loadUpcomingPractices();
        }

        // Actualizar estadísticas del dashboard
        function updateDashboardStats() {
            // Actualizar total de prácticas
            document.getElementById('total-practices').textContent = practiceData.length;
            
            // Calcular prácticas del mes actual
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            const monthPractices = practiceData.filter(practice => {
                const practiceDate = new Date(practice.date);
                return practiceDate.getMonth() + 1 === currentMonth && practiceDate.getFullYear() === currentYear;
            }).length;
            document.getElementById('month-practices').textContent = monthPractices;
            
            // Calcular número de profesores únicos
            const professors = [...new Set(practiceData.map(item => item.professor))];
            document.getElementById('total-professors').textContent = professors.length;
            
            // Calcular número de asignaturas únicas
            const subjects = [...new Set(practiceData.map(item => item.subject))];
            document.getElementById('total-subjects').textContent = subjects.length;
        }

        // === NUEVAS FUNCIONES PARA ACTIVIDADES RECIENTES Y PRÓXIMAS PRÁCTICAS ===

        // Cargar Actividades Recientes (con nuevo diseño)
        function loadRecentActivities() {
            const activitiesContainer = document.getElementById('recent-activities');
            if (!activitiesContainer) return;
            
            activitiesContainer.innerHTML = '';
            
            // Ordenar prácticas por fecha (más recientes primero)
            const sortedPractices = [...practiceData].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            // Tomar las 4 más recientes
            const recentPractices = sortedPractices.slice(0, 4);
            
            if (recentPractices.length === 0) {
                activitiesContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>No hay actividad reciente</p>
                    </div>
                `;
                return;
            }
            
            recentPractices.forEach(practice => {
                const activityDiv = document.createElement('div');
                activityDiv.className = 'activity-item';
                activityDiv.setAttribute('data-practice-id', practice.id);
                
                // Determinar tipo de actividad basado en el estado
                let activityType, activityIcon, activityIconBg;
                
                switch(practice.status) {
                    case 'programada':
                        activityType = 'Nueva práctica programada';
                        activityIcon = 'fas fa-plus-circle';
                        activityIconBg = 'bg-blue-100 text-blue-600';
                        break;
                    case 'confirmada':
                        activityType = 'Práctica Confirmada';
                        activityIcon = 'fas fa-check-circle';
                        activityIconBg = 'bg-green-100 text-green-600';
                        break;
                    case 'en-curso':
                        activityType = 'Práctica en Curso';
                        activityIcon = 'fas fa-play-circle';
                        activityIconBg = 'bg-yellow-100 text-yellow-600';
                        break;
                    case 'completada':
                        activityType = 'Práctica Completada';
                        activityIcon = 'fas fa-flag-checkered';
                        activityIconBg = 'bg-gray-100 text-gray-600';
                        break;
                    case 'cancelada':
                        activityType = 'Práctica Cancelada';
                        activityIcon = 'fas fa-exclamation-triangle';
                        activityIconBg = 'bg-red-100 text-red-600';
                        break;
                    default:
                        activityType = 'Actividad de Práctica';
                        activityIcon = 'fas fa-laptop-code';
                        activityIconBg = 'bg-primary-100 text-primary-600';
                }
                
                // Calcular tiempo relativo
                const practiceDate = new Date(practice.date);
                const now = new Date();
                const diffTime = Math.abs(now - practiceDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                let timeText = '';
                
                if (diffDays === 1) {
                    timeText = 'Hoy';
                } else if (diffDays === 2) {
                    timeText = 'Ayer';
                } else if (diffDays <= 7) {
                    timeText = `Hace ${diffDays - 1} días`;
                } else {
                    timeText = formatDate(practice.date);
                }
                
                activityDiv.innerHTML = `
                    <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${activityIconBg}">
                        <i class="${activityIcon} text-sm"></i>
                    </div>
                    <div class="activity-content">
                        <p class="activity-title">${activityType}</p>
                        <p class="activity-detail">${practice.practice} - ${practice.professor}</p>
                        <p class="activity-time">${timeText}</p>
                    </div>
                `;
                
                // Agregar evento click para abrir detalles
                activityDiv.addEventListener('click', function() {
                    openEditModal(practice.id);
                });
                
                activitiesContainer.appendChild(activityDiv);
            });
        }

        // Cargar Próximas Prácticas (con nuevo diseño adaptado)
        function loadUpcomingPractices() {
            const upcomingContainer = document.getElementById('upcoming-practices');
            if (!upcomingContainer) return;
            
            upcomingContainer.innerHTML = '';
            
            // Obtener fecha actual
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Filtrar prácticas futuras
            const upcomingPractices = practiceData.filter(practice => {
                const practiceDate = new Date(practice.date);
                practiceDate.setHours(0, 0, 0, 0);
                return practiceDate >= today;
            }).sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Tomar las 4 próximas
            const nextPractices = upcomingPractices.slice(0, 4);
            
            if (nextPractices.length === 0) {
                upcomingContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-times"></i>
                        <p>No hay prácticas próximas</p>
                    </div>
                `;
                return;
            }
            
            // Mapeo de estados a estilos - Adaptado del diseño proporcionado
            const practiceStatusStyles = {
                'programada': { 
                    bg: 'bg-blue-50',
                    tagBg: 'status-programada',
                    border: 'border-l-blue-500'
                },
                'confirmada': { 
                    bg: 'bg-green-50',
                    tagBg: 'status-confirmada',
                    border: 'border-l-green-500'
                },
                'en-curso': { 
                    bg: 'bg-yellow-50',
                    tagBg: 'status-en-curso',
                    border: 'border-l-yellow-500'
                },
                'completada': { 
                    bg: 'bg-gray-50',
                    tagBg: 'status-completada',
                    border: 'border-l-gray-500'
                },
                'cancelada': { 
                    bg: 'bg-red-50',
                    tagBg: 'status-cancelada',
                    border: 'border-l-red-500'
                }
            };
            
            // Textos para estados
            const statusTexts = {
                'programada': 'Programada',
                'confirmada': 'Confirmada',
                'en-curso': 'En Curso',
                'completada': 'Completada',
                'cancelada': 'Cancelada'
            };
            
            nextPractices.forEach(practice => {
                const styles = practiceStatusStyles[practice.status] || practiceStatusStyles['programada'];
                const statusText = statusTexts[practice.status] || practice.status;
                
                const practiceDiv = document.createElement('div');
                practiceDiv.className = `upcoming-practice-item ${styles.bg}`;
                practiceDiv.setAttribute('data-practice-id', practice.id);
                
                // Formatear fecha para mostrar
                const practiceDate = new Date(practice.date);
                const dateText = practiceDate.toLocaleDateString('es-ES', { 
                    day: 'numeric', 
                    month: 'short',
                    year: 'numeric'
                });
                
                // Obtener hora si existe
                const timeText = practice.time ? ` • ${practice.time}` : '';
                
                practiceDiv.innerHTML = `
                    <div class="upcoming-practice-info">
                        <div class="upcoming-practice-name">${practice.practice}</div>
                        <div class="upcoming-practice-meta">${practice.professor} - ${dateText}${timeText}</div>
                    </div>
                    <span class="upcoming-practice-status ${styles.tagBg}">${statusText}</span>
                `;
                
                // Agregar evento click para abrir detalles
                practiceDiv.addEventListener('click', function() {
                    openEditModal(practice.id);
                    
                    // Efecto visual de selección
                    const allItems = document.querySelectorAll('.upcoming-practice-item');
                    allItems.forEach(item => item.classList.remove('ring-2', 'ring-primary'));
                    
                    practiceDiv.classList.add('ring-2', 'ring-primary');
                });
                
                upcomingContainer.appendChild(practiceDiv);
            });
        }

        // === NUEVAS FUNCIONES PARA AGENDA POR LABORATORIO ===

        // Inicializar selector de laboratorios
        function initializeLabSelector() {
            const labSelector = document.getElementById('lab-selector');
            if (!labSelector) return;
            
            // Limpiar opciones existentes
            labSelector.innerHTML = '<option value="">Seleccione un laboratorio para ver su disponibilidad</option>';
            
            // Agregar laboratorios disponibles
            laboratoriesData.forEach(lab => {
                const option = document.createElement('option');
                option.value = lab.id;
                option.textContent = `${lab.name} - ${lab.building}`;
                labSelector.appendChild(option);
            });
            
            // Agregar event listener para cambiar laboratorio
            labSelector.addEventListener('change', function() {
                const labId = parseInt(this.value);
                if (labId) {
                    loadLabSchedule(labId);
                } else {
                    showNoLabSelected();
                }
            });
            
            // Configurar botón de refrescar
            const refreshBtn = document.getElementById('refresh-schedule');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    if (selectedLabId) {
                        loadLabSchedule(selectedLabId);
                    } else {
                        showNoLabSelected();
                    }
                });
            }
        }

        // Cargar horario de un laboratorio específico
        function loadLabSchedule(labId) {
            selectedLabId = labId;
            
            // Obtener información del laboratorio
            const lab = laboratoriesData.find(l => l.id === labId);
            if (!lab) return;
            
            // Mostrar información del laboratorio
            document.getElementById('current-lab-name').textContent = lab.name;
            document.getElementById('current-lab-building').textContent = lab.building;
            document.getElementById('selected-lab-info').classList.remove('hidden');
            
            // Contar prácticas para este laboratorio
            const labPractices = practiceData.filter(p => p.labId === labId);
            document.getElementById('current-lab-practices-count').textContent = `${labPractices.length} prácticas`;
            
            // Actualizar título
            document.getElementById('schedule-title').textContent = `Disponibilidad: ${lab.name}`;
            document.getElementById('schedule-subtitle').textContent = `Horario semanal - ${lab.building}`;
            document.getElementById('agenda-description').textContent = `La tabla muestra la disponibilidad del laboratorio "${lab.name}" para la semana actual.`;
            
            // Ocultar mensaje "seleccione laboratorio"
            document.getElementById('no-lab-selected').classList.add('hidden');
            document.getElementById('schedule-table').classList.remove('hidden');
            
            // Generar tabla de disponibilidad
            generateLabSchedule(labId);
        }

        // Generar tabla de disponibilidad para un laboratorio específico
        function generateLabSchedule(labId) {
            const scheduleBody = document.getElementById('schedule-body-agenda');
            if (!scheduleBody) return;
            
            scheduleBody.innerHTML = '';
            
            const days = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes'];
            const hours = ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00'];
            
            // Obtener prácticas para este laboratorio
            const labPractices = practiceData.filter(p => p.labId === labId && p.date && p.time);
            
            // Construir estructura de ocupación
            const labOccupancy = {};
            labPractices.forEach(practice => {
                const day = getDayFromDate(practice.date);
                if (day) {
                    if (!labOccupancy[day]) {
                        labOccupancy[day] = {};
                    }
                    labOccupancy[day][practice.time] = {
                        practice: practice.practice,
                        professor: practice.professor,
                        id: practice.id
                    };
                }
            });
            
            // Generar filas de horarios
            hours.forEach(hour => {
                const row = document.createElement('tr');
                
                // Celda de hora
                const timeCell = document.createElement('td');
                timeCell.className = 'p-2 border border-gray-300 text-center text-sm font-medium bg-gray-100 text-gray-800';
                timeCell.textContent = `${hour} - ${parseInt(hour.split(':')[0]) + 1}:00`;
                row.appendChild(timeCell);
                
                // Celdas para cada día
                days.forEach(day => {
                    const dayCell = document.createElement('td');
                    dayCell.className = 'p-1 border border-gray-300';
                    
                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'time-slot';
                    slotDiv.dataset.day = day;
                    slotDiv.dataset.hour = hour;
                    slotDiv.dataset.labId = labId;
                    
                    // Verificar si el horario está ocupado para este laboratorio
                    const isOccupied = labOccupancy[day] && labOccupancy[day][hour];
                    if (isOccupied) {
                        slotDiv.classList.add('occupied');
                        slotDiv.innerHTML = '<i class="fas fa-ban"></i>';
                        slotDiv.title = `${isOccupied.practice} - ${isOccupied.professor}`;
                        slotDiv.style.cursor = 'pointer';
                    } else {
                        slotDiv.classList.add('available');
                        slotDiv.innerHTML = '<i class="fas fa-check"></i>';
                        slotDiv.title = 'Disponible';
                        slotDiv.style.cursor = 'pointer';
                        
                        // Permitir seleccionar para nueva práctica
                        slotDiv.addEventListener('click', function() {
                            selectTimeSlotForLab(labId, day, hour);
                        });
                    }
                    
                    // Agregar evento de clic para mostrar información
                    slotDiv.addEventListener('click', function(e) {
                        if (this.classList.contains('occupied')) {
                            e.stopPropagation();
                            showPracticeInfoForLab(labId, day, hour);
                        }
                    });
                    
                    dayCell.appendChild(slotDiv);
                    row.appendChild(dayCell);
                });
                
                scheduleBody.appendChild(row);
            });
            
            console.log(`Tabla generada para laboratorio ID: ${labId}`);
        }

        // Seleccionar slot de tiempo para nueva práctica en laboratorio específico
        function selectTimeSlotForLab(labId, day, hour) {
            const lab = laboratoriesData.find(l => l.id === labId);
            if (!lab) return;
            
            // Guardar la selección temporalmente
            window.selectedTimeSlot = {
                labId: labId,
                labName: lab.name,
                day: day,
                hour: hour
            };
            
            // Abrir modal de nueva práctica con prellenado automático
            openNewPracticeModalForLab(labId, lab.name, day, hour);
        }

        // Abrir modal para nueva práctica en laboratorio específico
        function openNewPracticeModalForLab(labId, labName, day, hour) {
            // Limpiar el formulario
            document.getElementById('edit-practice-form').reset();
            document.getElementById('edit-practice-id').value = '';
            
            // Cambiar título
            document.getElementById('edit-modal-title').textContent = 'Nueva Práctica';
            
            // Cargar laboratorios en el select
            loadLaboratoriesSelect();
            
            // Establecer el laboratorio seleccionado
            const labSelect = document.getElementById('edit-practice-lab');
            if (labSelect) {
                // Buscar la opción correspondiente al laboratorio
                for (let i = 0; i < labSelect.options.length; i++) {
                    if (labSelect.options[i].value.includes(labName)) {
                        labSelect.selectedIndex = i;
                        break;
                    }
                }
            }
            
            // Mostrar modal
            const editModal = document.getElementById('edit-modal');
            editModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
            
            // Prellenar formulario con día y hora seleccionados
            if (day && hour) {
                prefillPracticeForm(day, hour);
            }
        }

        // Mostrar información de práctica existente para laboratorio específico
        function showPracticeInfoForLab(labId, day, hour) {
            // Buscar práctica en este laboratorio, día y hora
            const practice = practiceData.find(p => {
                if (!p.date || !p.time || p.labId !== labId) return false;
                const practiceDay = getDayFromDate(p.date);
                return practiceDay === day && p.time === hour;
            });
            
            if (practice) {
                showPracticeDetailsModal(practice);
            }
        }

        // Mostrar modal de detalles de práctica
        function showPracticeDetailsModal(practice) {
            // Crear un modal de información detallada
            const detailModal = document.createElement('div');
            detailModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in';
            detailModal.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 slide-in">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-xl font-bold text-gray-800">Información de Práctica</h3>
                            <button class="close-detail-modal text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Práctica:</label>
                                <p class="mt-1 text-sm text-gray-900">${practice.practice}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Profesor:</label>
                                <p class="mt-1 text-sm text-gray-900">${practice.professor}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Asignatura:</label>
                                <p class="mt-1 text-sm text-gray-900">${practice.subject}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Estado:</label>
                                <span class="mt-1 inline-flex px-2 text-xs font-semibold rounded-full 
                                    ${getStatusColor(practice.status)}">
                                    ${getStatusText(practice.status)}
                                </span>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Laboratorio:</label>
                                <p class="mt-1 text-sm text-gray-900">${practice.lab}</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Fecha:</label>
                                <p class="mt-1 text-sm text-gray-900">${formatDate(practice.date)} ${practice.time || ''}</p>
                            </div>
                            ${practice.objective ? `
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Objetivo:</label>
                                <p class="mt-1 text-sm text-gray-900">${practice.objective}</p>
                            </div>
                            ` : ''}
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button class="edit-practice-from-modal px-4 py-2 bg-primary text-white rounded-lg hover:bg-green-700 transition-colors" data-id="${practice.id}">
                                Editar
                            </button>
                            <button class="close-detail-modal px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors">
                                Cerrar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(detailModal);
            
            // Agregar event listeners para cerrar el modal
            const closeButtons = detailModal.querySelectorAll('.close-detail-modal');
            closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    document.body.removeChild(detailModal);
                });
            });
            
            // Agregar evento para editar desde el modal
            const editButton = detailModal.querySelector('.edit-practice-from-modal');
            if (editButton) {
                editButton.addEventListener('click', function() {
                    const practiceId = parseInt(this.getAttribute('data-id'));
                    document.body.removeChild(detailModal);
                    openEditModal(practiceId);
                });
            }
            
            // Cerrar al hacer clic fuera del modal
            detailModal.addEventListener('click', function(e) {
                if (e.target === detailModal) {
                    document.body.removeChild(detailModal);
                }
            });
        }

        // Mostrar estado "no hay laboratorio seleccionado"
        function showNoLabSelected() {
            selectedLabId = null;
            
            // Ocultar información del laboratorio
            document.getElementById('selected-lab-info').classList.add('hidden');
            
            // Mostrar mensaje "seleccione laboratorio"
            document.getElementById('no-lab-selected').classList.remove('hidden');
            document.getElementById('schedule-table').classList.add('hidden');
            
            // Actualizar títulos
            document.getElementById('schedule-title').textContent = 'Seleccione un laboratorio';
            document.getElementById('schedule-subtitle').textContent = 'La tabla mostrará la disponibilidad del laboratorio seleccionado';
            document.getElementById('agenda-description').textContent = 'La tabla muestra la disponibilidad del laboratorio seleccionado para la semana actual.';
        }

        // Actualizar agenda después de guardar
        function updateAgendaAfterSave(practice) {
            if (practice.labId && selectedLabId === practice.labId) {
                // Si el laboratorio guardado es el mismo que el mostrado, actualizar
                loadLabSchedule(practice.labId);
            }
            
            // Actualizar las vistas de actividades y próximas prácticas
            loadRecentActivities();
            loadUpcomingPractices();
        }

        // Actualizar agenda después de eliminar
        function updateAgendaAfterDelete(practiceId) {
            const deletedPractice = practiceData.find(p => p.id === practiceId);
            if (deletedPractice && deletedPractice.labId && selectedLabId === deletedPractice.labId) {
                // Si el laboratorio eliminado es el mismo que el mostrado, actualizar
                loadLabSchedule(deletedPractice.labId);
            }
            
            // Actualizar las vistas de actividades y próximas prácticas
            loadRecentActivities();
            loadUpcomingPractices();
        }

        // Obtener día de la semana a partir de una fecha
        function getDayFromDate(dateString) {
            try {
                const date = new Date(dateString);
                // Ajustar para problema de zona horaria
                date.setMinutes(date.getMinutes() + date.getTimezoneOffset());
                
                const days = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
                const dayName = days[date.getDay()];
                
                // Solo considerar días laborales (Lunes a Viernes)
                return ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes'].includes(dayName) ? dayName : null;
            } catch (error) {
                console.error('Error al convertir fecha:', dateString, error);
                return null;
            }
        }

        // NUEVA FUNCIÓN: Prellenar formulario con fecha y hora seleccionadas
        function prefillPracticeForm(day, hour) {
            // Esperar a que el modal esté completamente abierto
            setTimeout(() => {
                // Prellenar la hora en el select
                const timeSelect = document.getElementById('edit-practice-time');
                if (timeSelect) {
                    timeSelect.value = hour;
                }
                
                // Calcular y prellenar la fecha correspondiente al día seleccionado
                const targetDate = calculateDateFromDay(day);
                const dateInput = document.getElementById('edit-practice-date');
                if (dateInput) {
                    dateInput.value = targetDate;
                }
                
                console.log('Formulario prellenado:', {
                    día: day,
                    hora: hour,
                    fecha: targetDate
                });
            }, 100);
        }

        // NUEVA FUNCIÓN: Calcular fecha a partir del día de la semana
        function calculateDateFromDay(day) {
            const today = new Date();
            const daysOfWeek = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
            const targetDayIndex = daysOfWeek.indexOf(day);
            
            if (targetDayIndex === -1) return '';
            
            // Calcular la fecha del próximo día seleccionado
            const currentDayIndex = today.getDay();
            let daysToAdd = targetDayIndex - currentDayIndex;
            
            // Si el día ya pasó esta semana, ir a la próxima semana
            if (daysToAdd < 0) {
                daysToAdd += 7;
            }
            
            // Si es hoy y ya pasó la hora, ir a la próxima semana
            if (daysToAdd === 0) {
                const currentHour = today.getHours();
                const selectedHour = parseInt(hour.split(':')[0]);
                if (currentHour >= selectedHour) {
                    daysToAdd = 7;
                }
            }
            
            const targetDate = new Date(today);
            targetDate.setDate(today.getDate() + daysToAdd);
            
            // Formatear como YYYY-MM-DD para el input date
            const year = targetDate.getFullYear();
            const month = String(targetDate.getMonth() + 1).padStart(2, '0');
            const dayOfMonth = String(targetDate.getDate()).padStart(2, '0');
            
            return `${year}-${month}-${dayOfMonth}`;
        }

        // FUNCIONES AUXILIARES para estilos de estado
        function getStatusColor(status) {
            switch(status) {
                case 'programada': return 'bg-green-100 text-green-800';
                case 'confirmada': return 'bg-blue-100 text-blue-800';
                case 'en-curso': return 'bg-yellow-100 text-yellow-800';
                case 'completada': return 'bg-gray-100 text-gray-800';
                case 'cancelada': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'programada': return 'Programada';
                case 'confirmada': return 'Confirmada';
                case 'en-curso': return 'En curso';
                case 'completada': return 'Completada';
                case 'cancelada': return 'Cancelada';
                default: return status;
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Navegación del sidebar
            document.getElementById('dashboard-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('dashboard-view');
                updateActiveLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('practices-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('practices-view');
                updateActiveLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('agenda-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('agenda-view');
                updateActiveLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('users-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('users-view');
                updateActiveLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('laboratories-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('laboratories-view');
                updateActiveLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('reports-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('reports-view');
                updateActiveLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('settings-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('settings-view');
                updateActiveLink(this);
                closeMobileMenu();
            });
            
            // Botón Cerrar Sesión en sidebar - ADAPTADO DEL CÓDIGO MÁS PEQUEÑO
            document.getElementById('logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                abrirModalCerrarSesion();
                closeMobileMenu();
            });
            
            // Navegación móvil
            document.getElementById('mobile-dashboard-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('dashboard-view');
                updateActiveMobileLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('mobile-practices-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('practices-view');
                updateActiveMobileLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('mobile-agenda-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('agenda-view');
                updateActiveMobileLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('mobile-users-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('users-view');
                updateActiveMobileLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('mobile-laboratories-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('laboratories-view');
                updateActiveMobileLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('mobile-reports-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('reports-view');
                updateActiveMobileLink(this);
                closeMobileMenu();
            });
            
            document.getElementById('mobile-settings-link').addEventListener('click', function(e) {
                e.preventDefault();
                showView('settings-view');
                updateActiveMobileLink(this);
                closeMobileMenu();
            });
            
            // Botón Cerrar Sesión en menú móvil - ADAPTADO DEL CÓDIGO MÁS PEQUEÑO
            document.getElementById('mobile-logout-link').addEventListener('click', function(e) {
                e.preventDefault();
                abrirModalCerrarSesion();
                closeMobileMenu();
            });
            
            // Botones de prácticas - ACTUALIZADOS
            document.getElementById('add-practice-btn').addEventListener('click', function() {
                openNewPracticeModal(); // Modal vacío
            });
            
            document.getElementById('add-practice-agenda-btn').addEventListener('click', function() {
                openNewPracticeModal(); // Modal vacío
            });
            
            // Botón para agregar laboratorio
            document.getElementById('add-laboratory-btn').addEventListener('click', function() {
                openNewLaboratoryModal();
            });
            
            // Filtros de prácticas
            document.getElementById('search').addEventListener('input', function(e) {
                currentFilters.search = e.target.value.toLowerCase();
                filterPracticesData();
            });
            
            document.getElementById('professor-filter').addEventListener('change', function(e) {
                currentFilters.professor = e.target.value;
                filterPracticesData();
            });
            
            document.getElementById('status-filter').addEventListener('change', function(e) {
                currentFilters.status = e.target.value;
                filterPracticesData();
            });
            
            // Botón de restablecer filtros
            document.getElementById('reset-filters').addEventListener('click', function() {
                resetFilters();
            });
            
            // Botón de exportar PDF - Funcionalidad eliminada
            document.getElementById('export-pdf-btn').addEventListener('click', function() {
                // Función deshabilitada - solo muestra un mensaje
                showSuccessMessage('Función no disponible');
            });
            
            // Botón de exportar reportes
            document.getElementById('export-reports-btn').addEventListener('click', function() {
                // Función deshabilitada - solo muestra un mensaje
                showSuccessMessage('Función no disponible');
            });
            
            // Ordenamiento de columnas
            document.querySelectorAll('.sortable').forEach(header => {
                header.addEventListener('click', function() {
                    const column = this.getAttribute('data-column');
                    sortPracticesTable(column);
                });
            });
            
            // Filtros de reportes
            document.getElementById('reports-search').addEventListener('input', function(e) {
                currentReportsFilters.search = e.target.value.toLowerCase();
                filterReportsData();
            });
            
            document.getElementById('reports-professor-filter').addEventListener('change', function(e) {
                currentReportsFilters.professor = e.target.value;
                filterReportsData();
            });
            
            document.getElementById('reports-status-filter').addEventListener('change', function(e) {
                currentReportsFilters.status = e.target.value;
                filterReportsData();
            });
        }

        // Abrir menú móvil
        function openMobileMenu() {
            document.getElementById('mobile-sidebar').classList.remove('mobile-menu-closed');
            document.getElementById('mobile-sidebar').classList.add('mobile-menu-open');
        }

        // Cerrar menú móvil
        function closeMobileMenu() {
            document.getElementById('mobile-sidebar').classList.remove('mobile-menu-open');
            document.getElementById('mobile-sidebar').classList.add('mobile-menu-closed');
        }

        // Configurar listeners para modales
        function setupModalListeners() {
            const editModal = document.getElementById('edit-modal');
            const closeEditModal = document.getElementById('close-edit-modal');
            const cancelEdit = document.getElementById('cancel-edit');
            const editPracticeForm = document.getElementById('edit-practice-form');
            
            const deleteModal = document.getElementById('delete-modal');
            const closeDeleteModal = document.getElementById('close-delete-modal');
            const cancelDelete = document.getElementById('cancel-delete');
            const confirmDelete = document.getElementById('confirm-delete');
            
            const editUserModal = document.getElementById('edit-user-modal');
            const closeEditUserModal = document.getElementById('close-edit-user-modal');
            const cancelEditUser = document.getElementById('cancel-edit-user');
            const editUserForm = document.getElementById('edit-user-form');
            
            const deleteUserModal = document.getElementById('delete-user-modal');
            const closeDeleteUserModal = document.getElementById('close-delete-user-modal');
            const cancelDeleteUser = document.getElementById('cancel-delete-user');
            const confirmDeleteUser = document.getElementById('confirm-delete-user');
            
            // MODALES DE LABORATORIOS
            const editLaboratoryModal = document.getElementById('edit-laboratory-modal');
            const closeEditLaboratoryModal = document.getElementById('close-edit-laboratory-modal');
            const cancelEditLaboratory = document.getElementById('cancel-edit-laboratory');
            const editLaboratoryForm = document.getElementById('edit-laboratory-form');
            
            const deleteLaboratoryModal = document.getElementById('delete-laboratory-modal');
            const closeDeleteLaboratoryModal = document.getElementById('close-delete-laboratory-modal');
            const cancelDeleteLaboratory = document.getElementById('cancel-delete-laboratory');
            const confirmDeleteLaboratory = document.getElementById('confirm-delete-laboratory');
            
            // Cerrar modal de edición de práctica
            function closeEditModalFunc() {
                editModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                // Restaurar el header
                document.getElementById('header-container').classList.remove('modal-open');
                
                // Ocultar campo "Otro" si existe
                manageOtherLabInput(false);
            }

            if (closeEditModal) {
                closeEditModal.addEventListener('click', closeEditModalFunc);
            }
            if (cancelEdit) {
                cancelEdit.addEventListener('click', closeEditModalFunc);
            }

            // Cerrar modal al hacer clic fuera del contenido
            if (editModal) {
                editModal.addEventListener('click', function(e) {
                    if (e.target === editModal) {
                        closeEditModalFunc();
                    }
                });
            }

            // Envío del formulario de edición
            if (editPracticeForm) {
                editPracticeForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Obtener datos del formulario
                    const practiceId = parseInt(document.getElementById('edit-practice-id').value);
                    const practiceDate = document.getElementById('edit-practice-date').value;
                    const practiceTime = document.getElementById('edit-practice-time').value;
                    const practiceName = document.getElementById('edit-practice-name').value;
                    const practiceProfessor = document.getElementById('edit-practice-professor').value;
                    const practiceSubject = document.getElementById('edit-practice-subject').value;
                    const practiceObjective = document.getElementById('edit-practice-objective').value;
                    const practiceStatus = document.getElementById('edit-practice-status').value;
                    
                    // Obtener laboratorio
                    let practiceLab = document.getElementById('edit-practice-lab').value;
                    let practiceLabId = null;
                    let practiceLabName = practiceLab;
                    
                    // Si se seleccionó "Otro", usar el campo de texto
                    if (practiceLab === 'Otro') {
                        const otherLabInput = document.getElementById('other-lab-input');
                        if (otherLabInput) {
                            practiceLab = otherLabInput.value;
                            practiceLabName = practiceLab;
                        }
                    } else {
                        // Obtener ID del laboratorio seleccionado
                        const labSelect = document.getElementById('edit-practice-lab');
                        const selectedOption = labSelect.options[labSelect.selectedIndex];
                        practiceLabId = selectedOption.dataset.labId ? parseInt(selectedOption.dataset.labId) : null;
                        
                        // Buscar el laboratorio en la lista
                        const lab = laboratoriesData.find(l => l.id === practiceLabId);
                        if (lab) {
                            practiceLabName = lab.name;
                        }
                    }
                    
                    let isNewPractice = false;
                    let newPractice = null;
                    
                    if (practiceId) {
                        // Actualizar práctica existente en los datos
                        const practiceIndex = practiceData.findIndex(p => p.id === practiceId);
                        if (practiceIndex !== -1) {
                            // Es una actualización, verificar si cambió la fecha/hora
                            const oldPractice = practiceData.find(p => p.id === practiceId);
                            if (oldPractice && (oldPractice.date !== practiceDate || oldPractice.time !== practiceTime || oldPractice.labId !== practiceLabId)) {
                                // Si cambió la fecha/hora o laboratorio, actualizar agenda
                                updateAgendaAfterDelete(practiceId);
                            }
                            
                            practiceData[practiceIndex] = {
                                ...practiceData[practiceIndex],
                                date: practiceDate,
                                time: practiceTime,
                                practice: practiceName,
                                professor: practiceProfessor,
                                subject: practiceSubject,
                                objective: practiceObjective,
                                lab: practiceLab,
                                labId: practiceLabId,
                                labName: practiceLabName,
                                status: practiceStatus
                            };
                            
                            // Actualizar también en reportes si existe
                            const reportIndex = reportsData.findIndex(r => r.id === practiceId);
                            if (reportIndex !== -1) {
                                reportsData[reportIndex] = {
                                    ...reportsData[reportIndex],
                                    date: practiceDate,
                                    practice: practiceName,
                                    professor: practiceProfessor,
                                    subject: practiceSubject,
                                    objective: practiceObjective
                                };
                            }
                            
                            showSuccessMessage('Práctica actualizada correctamente');
                        }
                    } else {
                        // Crear nueva práctica
                        const newId = practiceData.length > 0 ? Math.max(...practiceData.map(p => p.id)) + 1 : 1;
                        newPractice = {
                            id: newId,
                            date: practiceDate,
                            time: practiceTime,
                            practice: practiceName,
                            professor: practiceProfessor,
                            subject: practiceSubject,
                            objective: practiceObjective,
                            lab: practiceLab,
                            labId: practiceLabId,
                            labName: practiceLabName,
                            status: practiceStatus
                        };
                        
                        practiceData.push(newPractice);
                        isNewPractice = true;
                        
                        // Crear también en reportes
                        reportsData.push({
                            id: newId,
                            date: practiceDate,
                            practice: practiceName,
                            objective: practiceObjective,
                            professor: practiceProfessor,
                            subject: practiceSubject
                        });
                        
                        showSuccessMessage('Práctica creada correctamente');
                    }
                    
                    updateDashboardStats();
                    
                    // Actualizar tablas - Usar los arrays actualizados
                    currentData = [...practiceData];
                    currentReportsData = [...reportsData];
                    
                    initializePracticesTable();
                    initializeReportsTable();
                    
                    // Actualizar agenda después de guardar
                    updateAgendaAfterSave(practiceId ? practiceData.find(p => p.id === practiceId) : newPractice);
                    
                    closeEditModalFunc();
                    
                    console.log('Práctica guardada:', {
                        id: practiceId || 'Nueva',
                        name: practiceName,
                        date: practiceDate,
                        time: practiceTime,
                        lab: practiceLab,
                        labId: practiceLabId,
                        labName: practiceLabName,
                        isNew: isNewPractice,
                        totalPractices: practiceData.length
                    });
                });
            }
            
            // Cerrar modal de eliminación de práctica
            function closeDeleteModalFunc() {
                deleteModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                // Restaurar el header
                document.getElementById('header-container').classList.remove('modal-open');
            }

            if (closeDeleteModal) {
                closeDeleteModal.addEventListener('click', closeDeleteModalFunc);
            }
            if (cancelDelete) {
                cancelDelete.addEventListener('click', closeDeleteModalFunc);
            }

            // Cerrar modal al hacer clic fuera del contenido
            if (deleteModal) {
                deleteModal.addEventListener('click', function(e) {
                    if (e.target === deleteModal) {
                        closeDeleteModalFunc();
                    }
                });
            }

            // Confirmar eliminación de práctica
            if (confirmDelete) {
                confirmDelete.addEventListener('click', function() {
                    const practiceId = parseInt(document.getElementById('delete-practice-id').value);
                    
                    // Actualizar agenda después de eliminar
                    updateAgendaAfterDelete(practiceId);
                    
                    // Eliminar práctica de los datos
                    const practiceIndex = practiceData.findIndex(p => p.id === practiceId);
                    if (practiceIndex !== -1) {
                        practiceData.splice(practiceIndex, 1);
                        
                        // Eliminar también de reportes
                        const reportIndex = reportsData.findIndex(r => r.id === practiceId);
                        if (reportIndex !== -1) {
                            reportsData.splice(reportIndex, 1);
                        }
                        
                        // Actualizar dashboard
                        updateDashboardStats();
                        
                        // Actualizar tablas - llamar a initializePracticesTable()
                        currentData = [...practiceData];
                        currentReportsData = [...reportsData];
                        initializePracticesTable();
                        initializeReportsTable();
                        
                        // Mostrar mensaje de éxito
                        showSuccessMessage('Práctica eliminada correctamente');
                    }
                    
                    // Cerrar modal
                    closeDeleteModalFunc();
                });
            }
            
            // Cerrar modal de edición de usuario
            function closeEditUserModalFunc() {
                editUserModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                // Restaurar el header
                document.getElementById('header-container').classList.remove('modal-open');
            }

            if (closeEditUserModal) {
                closeEditUserModal.addEventListener('click', closeEditUserModalFunc);
            }
            if (cancelEditUser) {
                cancelEditUser.addEventListener('click', closeEditUserModalFunc);
            }

            // Cerrar modal al hacer clic fuera del contenido
            if (editUserModal) {
                editUserModal.addEventListener('click', function(e) {
                    if (e.target === editUserModal) {
                        closeEditUserModalFunc();
                    }
                });
            }

            // Envío del formulario de edición de usuario - MODIFICADO: AGREGADO ACADEMIA
            if (editUserForm) {
                editUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Obtener datos del formulario
                    const userId = parseInt(document.getElementById('edit-user-id').value);
                    const userName = document.getElementById('edit-user-name').value;
                    const userUsername = document.getElementById('edit-user-username').value;
                    const userEmail = document.getElementById('edit-user-email').value;
                    const userRole = document.getElementById('edit-user-role').value;
                    const userAcademy = document.getElementById('edit-user-academy').value;
                    const userStatus = document.getElementById('edit-user-status').value;
                    
                    // Validar: Si es Profesor, debe tener academia
                    if (userRole === 'Profesor' && !userAcademy) {
                        alert('Los profesores deben tener una academia asignada');
                        return;
                    }
                    
                    // Validar: Si es Administrador, no debe tener academia
                    if (userRole === 'Administrador' && userAcademy) {
                        alert('Los administradores no deben tener academia asignada');
                        document.getElementById('edit-user-academy').value = '';
                        userAcademy = '';
                    }
                    
                    if (userId) {
                        // Actualizar usuario existente en los datos
                        const userIndex = usersData.findIndex(u => u.id === userId);
                        if (userIndex !== -1) {
                            usersData[userIndex] = {
                                ...usersData[userIndex],
                                name: userName,
                                username: userUsername,
                                email: userEmail,
                                role: userRole,
                                academy: userAcademy,
                                status: userStatus
                            };
                            
                            // Mostrar mensaje de éxito
                            showSuccessMessage('Usuario actualizado correctamente');
                        }
                    } else {
                        // Crear nuevo usuario
                        const newId = usersData.length > 0 ? Math.max(...usersData.map(u => u.id)) + 1 : 1;
                        const newUser = {
                            id: newId,
                            name: userName,
                            username: userUsername,
                            email: userEmail,
                            role: userRole,
                            academy: userAcademy,
                            status: userStatus,
                            lastAccess: 'Nunca'
                        };
                        
                        usersData.push(newUser);
                        
                        // Mostrar mensaje de éxito
                        showSuccessMessage('Usuario creada correctamente');
                    }
                    
                    // Actualizar tabla de usuarios
                    initializeUsersTable();
                    
                    // Cerrar modal
                    closeEditUserModalFunc();
                });
            }
            
            // Cerrar modal de eliminación de usuario
            function closeDeleteUserModalFunc() {
                deleteUserModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                // Restaurar el header
                document.getElementById('header-container').classList.remove('modal-open');
            }

            if (closeDeleteUserModal) {
                closeDeleteUserModal.addEventListener('click', closeDeleteUserModalFunc);
            }
            if (cancelDeleteUser) {
                cancelDeleteUser.addEventListener('click', closeDeleteUserModalFunc);
            }

            // Cerrar modal al hacer clic fuera del contenido
            if (deleteUserModal) {
                deleteUserModal.addEventListener('click', function(e) {
                    if (e.target === deleteUserModal) {
                        closeDeleteUserModalFunc();
                    }
                });
            }

            // Confirmar eliminación de usuario
            if (confirmDeleteUser) {
                confirmDeleteUser.addEventListener('click', function() {
                    const userId = parseInt(document.getElementById('delete-user-id').value);
                    
                    // Eliminar usuario de los datos
                    const userIndex = usersData.findIndex(u => u.id === userId);
                    if (userIndex !== -1) {
                        usersData.splice(userIndex, 1);
                        
                        // Actualizar tabla de usuarios
                        initializeUsersTable();
                        
                        // Mostrar mensaje de éxito
                        showSuccessMessage('Usuario eliminada correctamente');
                    }
                    
                    // Cerrar modal
                    closeDeleteUserModalFunc();
                });
            }
            
            // MODALES DE LABORATORIOS
            // Cerrar modal de edición de laboratorio
            function closeEditLaboratoryModalFunc() {
                editLaboratoryModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                // Restaurar el header
                document.getElementById('header-container').classList.remove('modal-open');
            }

            if (closeEditLaboratoryModal) {
                closeEditLaboratoryModal.addEventListener('click', closeEditLaboratoryModalFunc);
            }
            if (cancelEditLaboratory) {
                cancelEditLaboratory.addEventListener('click', closeEditLaboratoryModalFunc);
            }

            // Cerrar modal al hacer clic fuera del contenido
            if (editLaboratoryModal) {
                editLaboratoryModal.addEventListener('click', function(e) {
                    if (e.target === editLaboratoryModal) {
                        closeEditLaboratoryModalFunc();
                    }
                });
            }

            // Envío del formulario de edición de laboratorio
            if (editLaboratoryForm) {
                editLaboratoryForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // Obtener datos del formulario
                    const laboratoryId = parseInt(document.getElementById('edit-laboratory-id').value);
                    const laboratoryName = document.getElementById('edit-laboratory-name').value;
                    const laboratoryBuilding = document.getElementById('edit-laboratory-building').value;
                    
                    if (laboratoryId) {
                        // Actualizar laboratorio existente en los datos
                        const laboratoryIndex = laboratoriesData.findIndex(l => l.id === laboratoryId);
                        if (laboratoryIndex !== -1) {
                            // Actualizar también en las prácticas que usan este laboratorio
                            practiceData.forEach(practice => {
                                if (practice.labId === laboratoryId) {
                                    practice.lab = laboratoryName;
                                    practice.labName = laboratoryName;
                                }
                            });
                            
                            laboratoriesData[laboratoryIndex] = {
                                ...laboratoriesData[laboratoryIndex],
                                name: laboratoryName,
                                building: laboratoryBuilding
                            };
                            
                            // Mostrar mensaje de éxito
                            showSuccessMessage('Laboratorio actualizada correctamente');
                        }
                    } else {
                        // Crear nuevo laboratorio
                        const newId = laboratoriesData.length > 0 ? Math.max(...laboratoriesData.map(l => l.id)) + 1 : 1;
                        const newLaboratory = {
                            id: newId,
                            name: laboratoryName,
                            building: laboratoryBuilding
                        };
                        
                        laboratoriesData.push(newLaboratory);
                        
                        // Mostrar mensaje de éxito
                        showSuccessMessage('Laboratorio creada correctamente');
                    }
                    
                    // Actualizar tabla de laboratorios
                    initializeLaboratoriesTable();
                    
                    // Actualizar selector de laboratorios en agenda
                    initializeLabSelector();
                    
                    // Cerrar modal
                    closeEditLaboratoryModalFunc();
                });
            }
            
            // Cerrar modal de eliminación de laboratorio
            function closeDeleteLaboratoryModalFunc() {
                deleteLaboratoryModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                // Restaurar el header
                document.getElementById('header-container').classList.remove('modal-open');
            }

            if (closeDeleteLaboratoryModal) {
                closeDeleteLaboratoryModal.addEventListener('click', closeDeleteLaboratoryModalFunc);
            }
            if (cancelDeleteLaboratory) {
                cancelDeleteLaboratory.addEventListener('click', closeDeleteLaboratoryModalFunc);
            }

            // Cerrar modal al hacer clic fuera del contenido
            if (deleteLaboratoryModal) {
                deleteLaboratoryModal.addEventListener('click', function(e) {
                    if (e.target === deleteLaboratoryModal) {
                        closeDeleteLaboratoryModalFunc();
                    }
                });
            }

            // Confirmar eliminación de laboratorio
            if (confirmDeleteLaboratory) {
                confirmDeleteLaboratory.addEventListener('click', function() {
                    const laboratoryId = parseInt(document.getElementById('delete-laboratory-id').value);
                    
                    // Verificar si hay prácticas usando este laboratorio
                    const practicesUsingLab = practiceData.filter(p => p.labId === laboratoryId);
                    if (practicesUsingLab.length > 0) {
                        alert('No se puede eliminar el laboratorio porque tiene prácticas asignadas. Por favor, reasigne o elimine las prácticas primero.');
                        return;
                    }
                    
                    // Eliminar laboratorio de los datos
                    const laboratoryIndex = laboratoriesData.findIndex(l => l.id === laboratoryId);
                    if (laboratoryIndex !== -1) {
                        laboratoriesData.splice(laboratoryIndex, 1);
                        
                        // Actualizar tabla de laboratorios
                        initializeLaboratoriesTable();
                        
                        // Actualizar selector de laboratorios en agenda
                        initializeLabSelector();
                        
                        // Si el laboratorio eliminado estaba seleccionado en agenda, limpiar
                        if (selectedLabId === laboratoryId) {
                            showNoLabSelected();
                            document.getElementById('lab-selector').value = '';
                        }
                        
                        // Mostrar mensaje de éxito
                        showSuccessMessage('Laboratorio eliminada correctamente');
                    }
                    
                    // Cerrar modal
                    closeDeleteLaboratoryModalFunc();
                });
            }
        }

        // Abrir modal para nuevo laboratorio
        function openNewLaboratoryModal() {
            // Limpiar el formulario
            document.getElementById('edit-laboratory-form').reset();
            document.getElementById('edit-laboratory-id').value = '';
            
            // Cambiar título del modal
            document.getElementById('edit-laboratory-modal-title').textContent = 'Agregar Laboratorio';
            
            // Mostrar modal
            const editLaboratoryModal = document.getElementById('edit-laboratory-modal');
            editLaboratoryModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Abrir modal para editar laboratorio
        function openEditLaboratoryModal(laboratoryId) {
            const laboratory = laboratoriesData.find(l => l.id === laboratoryId);
            if (!laboratory) return;
            
            // Llenar el formulario con los datos actuales
            document.getElementById('edit-laboratory-id').value = laboratory.id;
            document.getElementById('edit-laboratory-name').value = laboratory.name;
            document.getElementById('edit-laboratory-building').value = laboratory.building;
            
            // Cambiar título del modal
            document.getElementById('edit-laboratory-modal-title').textContent = 'Editar Laboratorio';
            
            // Mostrar modal
            const editLaboratoryModal = document.getElementById('edit-laboratory-modal');
            editLaboratoryModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Abrir modal para eliminar laboratorio
        function openDeleteLaboratoryModal(laboratoryId, laboratoryName, laboratoryBuilding) {
            // Llenar la información del laboratorio a eliminar
            document.getElementById('delete-laboratory-id').value = laboratoryId;
            document.getElementById('delete-laboratory-name').textContent = laboratoryName;
            document.getElementById('delete-laboratory-details').textContent = `Edificio: ${laboratoryBuilding}`;
            
            // Mostrar modal
            const deleteLaboratoryModal = document.getElementById('delete-laboratory-modal');
            deleteLaboratoryModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Mostrar mensaje de éxito
        function showSuccessMessage(message) {
            const successMessage = document.getElementById('success-message');
            const successText = document.getElementById('success-text');
            
            successText.textContent = message;
            successMessage.classList.remove('hidden');
            
            // Ocultar mensaje después de 3 segundos
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 3000);
        }

        // Mostrar vista específica
        function showView(viewId) {
            // Ocultar todas las vistas
            document.getElementById('dashboard-view').classList.add('hidden');
            document.getElementById('practices-view').classList.add('hidden');
            document.getElementById('agenda-view').classList.add('hidden');
            document.getElementById('users-view').classList.add('hidden');
            document.getElementById('laboratories-view').classList.add('hidden');
            document.getElementById('reports-view').classList.add('hidden');
            document.getElementById('settings-view').classList.add('hidden');
            
            // Mostrar la vista seleccionada
            document.getElementById(viewId).classList.remove('hidden');
            
            // Si es la vista de configuración, actualizar tempSettings
            if (viewId === 'settings-view') {
                const emailNotificationsToggle = document.getElementById('email-notifications');
                const languageSelect = document.getElementById('language');
                
                if (emailNotificationsToggle) {
                    emailNotificationsToggle.checked = tempSettings.emailNotifications;
                }
                if (languageSelect) {
                    languageSelect.value = tempSettings.language;
                }
            }
            
            // Si es la vista de agenda, inicializar selector si no está inicializado
            if (viewId === 'agenda-view') {
                // Verificar si el selector ya está inicializado
                const labSelector = document.getElementById('lab-selector');
                if (labSelector && labSelector.options.length <= 1) {
                    initializeLabSelector();
                }
            }
        }

        // Actualizar enlace activo en el sidebar
        function updateActiveLink(activeLink) {
            // Remover clase activa de todos los enlaces
            document.querySelectorAll('.sidebar a').forEach(link => {
                link.classList.remove('bg-primary', 'text-white');
                link.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            
            // Agregar clase activa al enlace seleccionado
            activeLink.classList.remove('text-gray-700', 'hover:bg-gray-100');
            activeLink.classList.add('bg-primary', 'text-white');
        }

        // Actualizar enlace activo en el menú móvil
        function updateActiveMobileLink(activeLink) {
            // Remover clase activa de todos los enlaces
            document.querySelectorAll('#mobile-sidebar a').forEach(link => {
                link.classList.remove('bg-primary', 'text-white');
                link.classList.add('text-gray-700', 'hover:bg-gray-100');
            });
            
            // Agregar clase activa al enlace seleccionado
            activeLink.classList.remove('text-gray-700', 'hover:bg-gray-100');
            activeLink.classList.add('bg-primary', 'text-white');
        }

        // Inicializar tabla de prácticas
        function initializePracticesTable() {
            const tableBody = document.getElementById('table-body');
            if (!tableBody) {
                console.error('No se encontró table-body');
                return;
            }
            
            tableBody.innerHTML = '';
            
            console.log('Renderizando tabla con', currentData.length, 'prácticas');
            
            // Generar filas de la tabla
            currentData.forEach((item) => {
                const row = document.createElement('tr');
                row.className = 'bg-white';
                
                // Determinar color del estado
                let statusColor = '';
                let statusText = '';
                switch(item.status) {
                    case 'programada':
                        statusColor = 'bg-green-100 text-green-800';
                        statusText = 'Programada';
                        break;
                    case 'confirmada':
                        statusColor = 'bg-blue-100 text-blue-800';
                        statusText = 'Confirmada';
                        break;
                    case 'en-curso':
                        statusColor = 'bg-yellow-100 text-yellow-800';
                        statusText = 'En curso';
                        break;
                    case 'completada':
                        statusColor = 'bg-gray-100 text-gray-800';
                        statusText = 'Completada';
                        break;
                    case 'cancelada':
                        statusColor = 'bg-red-100 text-red-800';
                        statusText = 'Cancelada';
                        break;
                    default:
                        statusColor = 'bg-gray-100 text-gray-800';
                        statusText = item.status;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(item.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.practice}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.professor}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.subject}</td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                            ${statusText}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="edit-practice-btn text-indigo-600 hover:text-indigo-900 mr-3"
                                data-id="${item.id}">
                            Editar
                        </button>
                        <button class="delete-practice-btn text-red-600 hover:text-red-900"
                                data-id="${item.id}"
                                data-practice="${item.practice}"
                                data-professor="${item.professor}"
                                data-date="${formatDate(item.date)}">
                            Eliminar
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Agregar event listeners a los botones de editar y eliminar
            document.querySelectorAll('.edit-practice-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const practiceId = parseInt(this.getAttribute('data-id'));
                    openEditModal(practiceId);
                });
            });
            
            document.querySelectorAll('.delete-practice-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const practiceId = parseInt(this.getAttribute('data-id'));
                    const practiceName = this.getAttribute('data-practice');
                    const practiceProfessor = this.getAttribute('data-professor');
                    const practiceDate = this.getAttribute('data-date');
                    openDeleteModal(practiceId, practiceName, practiceProfessor, practiceDate);
                });
            });
            
            // ACTUALIZAR CONTADORES Y FILTROS
            updateResultsCount();
            updateFilters();
            
            console.log('Tabla de prácticas actualizada correctamente');
        }

        // Inicializar tabla de usuarios - MODIFICADO: AGREGADO CAMPO ACADEMIA
        function initializeUsersTable() {
            const tableBody = document.getElementById('users-table-body');
            tableBody.innerHTML = '';
            
            // Generar filas de la tabla
            usersData.forEach((item) => {
                const row = document.createElement('tr');
                // Todas las filas serán claras
                row.className = 'bg-white';
                
                // Determinar color del estado
                let statusColor = '';
                let statusText = '';
                switch(item.status) {
                    case 'Activo':
                        statusColor = 'bg-green-100 text-green-800';
                        statusText = 'Activo';
                        break;
                    case 'Inactivo':
                        statusColor = 'bg-red-100 text-red-800';
                        statusText = 'Inactivo';
                        break;
                }
                
                // Determinar color del rol
                let roleColor = '';
                let roleText = '';
                switch(item.role) {
                    case 'Administrador':
                        roleColor = 'bg-purple-100 text-purple-800';
                        roleText = 'Administrador';
                        break;
                    case 'Profesor':
                        roleColor = 'bg-blue-100 text-blue-800';
                        roleText = 'Profesor';
                        break;
                }
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10">
                                <div class="h-10 w-10 rounded-full bg-primary flex items-center justify-center text-white font-semibold">
                                    ${item.name.charAt(0)}
                                </div>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">
                                    ${item.name}
                                </div>
                                <div class="text-sm text-gray-500">
                                    ${item.username}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${roleColor}">
                            ${roleText}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${item.email}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${item.academy || '-'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                            ${statusText}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${item.lastAccess}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="edit-user-btn text-indigo-600 hover:text-indigo-900 mr-3"
                                data-id="${item.id}">
                            Editar
                        </button>
                        <button class="delete-user-btn text-red-600 hover:text-red-900"
                                data-id="${item.id}"
                                data-name="${item.name}">
                            Eliminar
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Agregar event listeners a los botones de editar y eliminar
            document.querySelectorAll('.edit-user-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = parseInt(this.getAttribute('data-id'));
                    openEditUserModal(userId);
                });
            });
            
            document.querySelectorAll('.delete-user-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const userId = parseInt(this.getAttribute('data-id'));
                    const userName = this.getAttribute('data-name');
                    openDeleteUserModal(userId, userName);
                });
            });
        }

        // Inicializar tabla de laboratorios
        function initializeLaboratoriesTable() {
            const tableBody = document.getElementById('laboratories-table-body');
            tableBody.innerHTML = '';
            
            // Generar filas de la tabla
            laboratoriesData.forEach((item) => {
                const row = document.createElement('tr');
                row.className = 'bg-white';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.building}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="edit-laboratory-btn text-indigo-600 hover:text-indigo-900 mr-3"
                                data-id="${item.id}">
                            Editar
                        </button>
                        <button class="delete-laboratory-btn text-red-600 hover:text-red-900"
                                data-id="${item.id}"
                                data-name="${item.name}"
                                data-building="${item.building}">
                            Eliminar
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Agregar event listeners a los botones de editar y eliminar
            document.querySelectorAll('.edit-laboratory-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const laboratoryId = parseInt(this.getAttribute('data-id'));
                    openEditLaboratoryModal(laboratoryId);
                });
            });
            
            document.querySelectorAll('.delete-laboratory-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const laboratoryId = parseInt(this.getAttribute('data-id'));
                    const laboratoryName = this.getAttribute('data-name');
                    const laboratoryBuilding = this.getAttribute('data-building');
                    openDeleteLaboratoryModal(laboratoryId, laboratoryName, laboratoryBuilding);
                });
            });
        }

        // Inicializar tabla de reportes
        function initializeReportsTable() {
            const tableBody = document.getElementById('reports-table-body');
            tableBody.innerHTML = '';
            
            // Generar filas de la tabla
            currentReportsData.forEach((item) => {
                const row = document.createElement('tr');
                // Todas las filas serán claras
                row.className = 'bg-white';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(item.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.practice}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${item.objective}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.professor}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.subject}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button class="edit-report-btn text-indigo-600 hover:text-indigo-900 mr-3"
                                data-id="${item.id}">
                            Editar
                        </button>
                        <button class="delete-report-btn text-red-600 hover:text-red-900"
                                data-id="${item.id}"
                                data-practice="${item.practice}"
                                data-professor="${item.professor}"
                                data-date="${formatDate(item.date)}">
                            Eliminar
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Agregar event listeners a los botones de editar y eliminar
            document.querySelectorAll('.edit-report-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const reportId = parseInt(this.getAttribute('data-id'));
                    openEditReportModal(reportId);
                });
            });
            
            document.querySelectorAll('.delete-report-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const reportId = parseInt(this.getAttribute('data-id'));
                    const reportName = this.getAttribute('data-practice');
                    const reportProfessor = this.getAttribute('data-professor');
                    const reportDate = this.getAttribute('data-date');
                    openDeleteReportModal(reportId, reportName, reportProfessor, reportDate);
                });
            });
        }

        // Abrir modal de edición para reportes
        function openEditReportModal(reportId) {
            const report = reportsData.find(p => p.id === reportId);
            if (!report) return;
            
            // Llenar el formulario con los datos actuales
            document.getElementById('edit-practice-id').value = report.id;
            document.getElementById('edit-practice-date').value = report.date;
            document.getElementById('edit-practice-name').value = report.practice;
            document.getElementById('edit-practice-professor').value = report.professor;
            document.getElementById('edit-practice-subject').value = report.subject;
            document.getElementById('edit-practice-objective').value = report.objective || '';
            
            // Cargar laboratorios en el select
            loadLaboratoriesSelect();
            
            // Buscar el laboratorio en practiceData
            const practice = practiceData.find(p => p.id === reportId);
            if (practice && practice.lab) {
                const labSelect = document.getElementById('edit-practice-lab');
                // Buscar si el laboratorio existe en la lista
                let found = false;
                for (let i = 0; i < labSelect.options.length; i++) {
                    if (labSelect.options[i].value.includes(practice.lab)) {
                        labSelect.selectedIndex = i;
                        found = true;
                        break;
                    }
                }
                
                // Si no se encuentra, seleccionar "Otro" y llenar el campo
                if (!found && practice.lab) {
                    labSelect.value = 'Otro';
                    manageOtherLabInput(true);
                    const otherLabInput = document.getElementById('other-lab-input');
                    if (otherLabInput) {
                        otherLabInput.value = practice.lab;
                    }
                }
            }
            
            document.getElementById('edit-practice-status').value = practice ? practice.status : 'programada';
            
            // Mostrar modal
            const editModal = document.getElementById('edit-modal');
            editModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Abrir modal de eliminación para reportes
        function openDeleteReportModal(reportId, reportName, reportProfessor, reportDate) {
            // Llenar la información de la práctica a eliminar
            document.getElementById('delete-practice-id').value = reportId;
            document.getElementById('delete-practice-name').textContent = reportName;
            document.getElementById('delete-practice-details').textContent = `${reportProfessor} - ${reportDate}`;
            
            // Mostrar modal
            const deleteModal = document.getElementById('delete-modal');
            deleteModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Abrir modal de edición
        function openEditModal(practiceId) {
            const practice = practiceData.find(p => p.id === practiceId);
            if (!practice) return;
            
            // Llenar el formulario con los datos actuales
            document.getElementById('edit-practice-id').value = practice.id;
            document.getElementById('edit-practice-date').value = practice.date;
            document.getElementById('edit-practice-time').value = practice.time || '';
            document.getElementById('edit-practice-name').value = practice.practice;
            document.getElementById('edit-practice-professor').value = practice.professor;
            document.getElementById('edit-practice-subject').value = practice.subject;
            document.getElementById('edit-practice-objective').value = practice.objective || '';
            document.getElementById('edit-practice-status').value = practice.status;
            
            // Cargar laboratorios en el select
            loadLaboratoriesSelect();
            
            // Buscar el laboratorio en la lista
            const labSelect = document.getElementById('edit-practice-lab');
            if (practice.lab) {
                // Buscar si el laboratorio existe en la lista
                let found = false;
                for (let i = 0; i < labSelect.options.length; i++) {
                    if (labSelect.options[i].value.includes(practice.lab)) {
                        labSelect.selectedIndex = i;
                        found = true;
                        break;
                    }
                }
                
                // Si no se encuentra, seleccionar "Otro" y llenar el campo
                if (!found && practice.lab) {
                    labSelect.value = 'Otro';
                    manageOtherLabInput(true);
                    const otherLabInput = document.getElementById('other-lab-input');
                    if (otherLabInput) {
                        otherLabInput.value = practice.lab;
                    }
                }
            }
            
            // Cambiar título
            document.getElementById('edit-modal-title').textContent = 'Editar Práctica';
            
            // Mostrar modal
            const editModal = document.getElementById('edit-modal');
            editModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Abrir modal de eliminación
        function openDeleteModal(practiceId, practiceName, practiceProfessor, practiceDate) {
            // Llenar la información de la práctica a eliminar
            document.getElementById('delete-practice-id').value = practiceId;
            document.getElementById('delete-practice-name').textContent = practiceName;
            document.getElementById('delete-practice-details').textContent = `${practiceProfessor} - ${practiceDate}`;
            
            // Mostrar modal
            const deleteModal = document.getElementById('delete-modal');
            deleteModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Cargar laboratorios en el select
        function loadLaboratoriesSelect() {
            const labSelect = document.getElementById('edit-practice-lab');
            if (!labSelect) return;
            
            // Limpiar opciones existentes excepto la primera
            while (labSelect.options.length > 1) {
                labSelect.remove(1);
            }
            
            // Agregar laboratorios disponibles
            laboratoriesData.forEach(lab => {
                const option = document.createElement('option');
                option.value = `${lab.name} (${lab.building})`;
                option.textContent = `${lab.name} - ${lab.building}`;
                option.dataset.labId = lab.id;
                labSelect.appendChild(option);
            });
            
            // Agregar opción "Otro" para laboratorios no listados
            const otherOption = document.createElement('option');
            otherOption.value = 'Otro';
            otherOption.textContent = 'Otro (especificar)';
            labSelect.appendChild(otherOption);
            
            // Agregar event listener para mostrar campo de texto cuando se selecciona "Otro"
            labSelect.addEventListener('change', function() {
                manageOtherLabInput(this.value === 'Otro');
            });
        }

        // Manejar campo de texto para "Otro" laboratorio
        function manageOtherLabInput(show) {
            // Buscar o crear el campo de texto
            let otherLabInput = document.getElementById('other-lab-input');
            const labSelect = document.getElementById('edit-practice-lab');
            
            if (show) {
                if (!otherLabInput) {
                    otherLabInput = document.createElement('input');
                    otherLabInput.type = 'text';
                    otherLabInput.id = 'other-lab-input';
                    otherLabInput.placeholder = 'Especifique el laboratorio/aula';
                    otherLabInput.className = 'w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition-colors mt-2';
                    
                    // Insertar después del select
                    labSelect.parentNode.appendChild(otherLabInput);
                } else {
                    otherLabInput.classList.remove('hidden');
                }
                
                // Hacer que el select sea opcional cuando se selecciona "Otro"
                labSelect.required = false;
                otherLabInput.required = true;
            } else {
                if (otherLabInput) {
                    otherLabInput.classList.add('hidden');
                    otherLabInput.required = false;
                }
                
                // Hacer que el select sea obligatorio
                labSelect.required = true;
            }
        }

        // Abrir modal para nueva práctica
        function openNewPracticeModal() {
            // Limpiar el formulario
            document.getElementById('edit-practice-form').reset();
            document.getElementById('edit-practice-id').value = '';
            
            // Cambiar título
            document.getElementById('edit-modal-title').textContent = 'Nueva Práctica';
            
            // Cargar laboratorios en el select
            loadLaboratoriesSelect();
            
            // Mostrar modal
            const editModal = document.getElementById('edit-modal');
            editModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            // Oscurecer el header
            document.getElementById('header-container').classList.add('modal-open');
        }

        // Filtrar datos de prácticas
        function filterPracticesData() {
            let filteredData = [...practiceData];
            
            // Aplicar filtro de búsqueda
            if (currentFilters.search) {
                filteredData = filteredData.filter(item => 
                    item.practice.toLowerCase().includes(currentFilters.search) ||
                    item.professor.toLowerCase().includes(currentFilters.search) ||
                    item.subject.toLowerCase().includes(currentFilters.search)
                );
            }
            
            // Aplicar filtro por profesor
            if (currentFilters.professor) {
                filteredData = filteredData.filter(item => item.professor === currentFilters.professor);
            }
            
            // Aplicar filtro por estado
            if (currentFilters.status) {
                filteredData = filteredData.filter(item => item.status === currentFilters.status);
            }
            
            currentData = filteredData;
            sortPracticesTable(sortColumn, sortDirection);
            
            initializePracticesTable();
        }

        // Filtrar datos de reportes
        function filterReportsData() {
            let filteredData = [...reportsData];
            
            // Aplicar filtro de búsqueda
            if (currentReportsFilters.search) {
                filteredData = filteredData.filter(item => 
                    item.practice.toLowerCase().includes(currentReportsFilters.search) ||
                    item.professor.toLowerCase().includes(currentReportsFilters.search) ||
                    item.subject.toLowerCase().includes(currentReportsFilters.search) ||
                    item.objective.toLowerCase().includes(currentReportsFilters.search)
                );
            }
            
            // Aplicar filtro por profesor
            if (currentReportsFilters.professor) {
                filteredData = filteredData.filter(item => item.professor === currentReportsFilters.professor);
            }
            
            // Aplicar filtro por estado (si existe en los datos)
            if (currentReportsFilters.status) {
                // En este caso, los reportes no tienen estado, pero podríamos filtrar por otros criterios
                // Por ejemplo, podríamos filtrar por asignatura si se desea
            }
            
            currentReportsData = filteredData;
            initializeReportsTable();
            updateReportsResultsCount();
        }

        // Ordenar tabla de prácticas
        function sortPracticesTable(column, direction = null) {
            // Determinar dirección de ordenamiento
            if (column === sortColumn) {
                sortDirection = direction || (sortDirection === 'asc' ? 'desc' : 'asc');
            } else {
                sortColumn = column;
                sortDirection = 'asc';
            }
            
            // Aplicar ordenamiento
            currentData.sort((a, b) => {
                let aValue = a[column];
                let bValue = b[column];
                
                // Para fechas, convertir a objetos Date
                if (column === 'date') {
                    aValue = new Date(aValue);
                    bValue = new Date(bValue);
                } else {
                    // Para texto, convertir a minúsculas para ordenamiento case-insensitive
                    aValue = String(aValue).toLowerCase();
                    bValue = String(bValue).toLowerCase();
                }
                
                if (aValue < bValue) return sortDirection === 'asc' ? -1 : 1;
                if (aValue > bValue) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
            
            // Actualizar indicadores visuales de ordenamiento
            updateSortIndicators();
            
            // Volver a renderizar la tabla
            initializePracticesTable();
        }

        // Actualizar indicadores visuales de ordenamiento
        function updateSortIndicators() {
            document.querySelectorAll('.sortable').forEach(header => {
                header.classList.remove('active-sort');
                const icon = header.querySelector('.sort-icon');
                
                if (header.getAttribute('data-column') === sortColumn) {
                    header.classList.add('active-sort');
                    icon.textContent = sortDirection === 'asc' ? '↑' : '↓';
                } else {
                    icon.textContent = '↕';
                }
            });
        }

        // Actualizar filtros desplegables
        function updateFilters() {
            const professorFilter = document.getElementById('professor-filter');
            
            // Obtener valores únicos
            const professors = [...new Set(practiceData.map(item => item.professor))];
            
            // Limpiar opciones existentes (excepto la primera)
            while (professorFilter.children.length > 1) {
                professorFilter.removeChild(professorFilter.lastChild);
            }
            
            // Agregar opciones
            professors.forEach(professor => {
                const option = document.createElement('option');
                option.value = professor;
                option.textContent = professor;
                professorFilter.appendChild(option);
            });
            
            // Restaurar valores seleccionados si existen
            if (currentFilters.professor) {
                professorFilter.value = currentFilters.professor;
            }
            if (currentFilters.status) {
                document.getElementById('status-filter').value = currentFilters.status;
            }
        }

        // Restablecer filtros
        function resetFilters() {
            document.getElementById('search').value = '';
            document.getElementById('professor-filter').value = '';
            document.getElementById('status-filter').value = '';
            
            currentFilters = {
                search: '',
                professor: '',
                status: ''
            };
            
            currentData = [...practiceData];
            sortPracticesTable('date', 'asc');
            initializePracticesTable();
        }

        // Actualizar contador de resultados
        function updateResultsCount() {
            const resultsCount = document.getElementById('results-count');
            const totalCount = document.getElementById('total-count');
            
            if (resultsCount && totalCount) {
                resultsCount.textContent = currentData.length;
                totalCount.textContent = practiceData.length;
                console.log('Contadores actualizados:', currentData.length, 'de', practiceData.length);
            }
        }

        // Actualizar contador de resultados de reportes
        function updateReportsResultsCount() {
            document.getElementById('reports-results-count').textContent = currentReportsData.length;
            document.getElementById('reports-total-count').textContent = reportsData.length;
        }

        // Formatear fecha
        function formatDate(dateString) {
            const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('es-ES', options);
        }

        // Hacer las funciones globales
        window.showView = showView;
        window.openNewLaboratoryModal = openNewLaboratoryModal;
        window.openEditLaboratoryModal = openEditLaboratoryModal;
    </script>
</body>
</html>